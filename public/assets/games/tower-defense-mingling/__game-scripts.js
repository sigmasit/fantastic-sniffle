var SpawnLocation=pc.createScript("spawnLocation");SpawnLocation.attributes.add("spawnInterval",{type:"number",default:5}),SpawnLocation.attributes.add("waveOver",{type:"boolean",default:!1}),SpawnLocation.attributes.add("sceneName",{type:"string",default:"",title:"Scene to load:"}),SpawnLocation.prototype.initialize=function(){this.timeToSpawn=0,this.currentWave=1,this.wave1=1,this.wave2=1,this.wave3=1,this.endlessWave=10,this.endlessWaveTemp=0,this.robot="Robot 1"},SpawnLocation.prototype.setEndlessWaveCount=function(e){this.endlessWave=e,this.endlessWaveTemp=e},SpawnLocation.prototype.decrementEndlessWaveSpawn=function(){this.endlessWave--},SpawnLocation.prototype.incrementEndlessWaveCountReset=function(){this.endlessWaveTemp+=10;var e=this.endlessWaveTemp;this.endlessWave=e,this.app.root.findByName("Game").script.game.incrementWaveEndless4()},SpawnLocation.prototype.resetWaves=function(){this.currentWave=1},SpawnLocation.prototype.changeRobot=function(e){this.robot=e},SpawnLocation.prototype.update=function(e){if(!this.entity.parent.script.game.showingAd&&!this.entity.parent.script.game.gamePause)switch(this.currentWave){case 1:this.doubleSpawnCheck()?this.entity===this.firstSpawn()&&this.spawnEnemies(e,this.wave1):this.spawnEnemies(e,this.wave1);break;case 2:this.doubleSpawnCheck()?this.entity===this.secondSpawn()&&this.spawnEnemies(e,this.wave2):this.spawnEnemies(e,this.wave2);break;case 3:this.spawnEnemies(e,this.wave3);break;default:this.spawnEndlessModeState()&&this.spawnEnemies(e,this.endlessWave)}},SpawnLocation.prototype.spawnEndlessModeState=function(){return this.app.root.findByName("Game").script.game.gameEndlessModeState()},SpawnLocation.prototype.spawnEntities=function(){return this.entity.parent.findByTag("SpawnLocation")},SpawnLocation.prototype.doubleSpawnCheck=function(){return this.spawnEntities().length>1},SpawnLocation.prototype.firstSpawn=function(){var e=this.spawnEntities();if(e)return e[0]},SpawnLocation.prototype.secondSpawn=function(){var e=this.spawnEntities();if(e)return e[1]},SpawnLocation.prototype.changeWaveEnemies=function(e,t,a){this.currentWave=1,this.wave1=e,this.wave2=t,this.wave3=a},SpawnLocation.prototype.nextPhase=function(){var e=this.entity.parent;if(this.waveOver&&this.currentWave<3){this.currentWave+=1,this.newWave(),this.entity===this.firstSpawn()&&PokiSDK.gameplayStart(),e.script.game.gamePauseState(!1);this.entity.parent.script.game.firstSpeedUpTutorial&&1===this.entity.parent.script.mapsystem.levelNumber()&&2===this.currentWave?(this.app.timeScale=0,this.entity.parent.script.game.speedBonusRewardHudBtn.button.active=!0,this.entity.parent.script.game.speedMechanicTutorial(!0),this.entity.parent.script.game.setFirstSpeedState(!1)):this.entity.parent.script.game.firstSpeedLockedGame&&1===this.entity.parent.script.mapsystem.levelNumber()&&3===this.currentWave&&(e.script.game.firstSpeedLockedHandler(),e.script.game.speedBonusTimer(0),e.script.game.speedingUpTimerReset(0),e.script.game.speedUpState(!1))}else if(this.spawnEndlessModeState())this.currentWave+=1,this.newWave(),e.script.game.gamePauseState(!1),this.incrementEndlessWaveCountReset(),this.entity===this.firstSpawn()&&PokiSDK.gameplayStart();else if(this.waveOver&&this.currentWave>=3){this.newWave(),this.levelSuccess(!1),e.script.game.gamePauseState(!1);var t=this.app,a=t.root.findByName("UI"),n=a.findByName("Levels"),i=a.findByName("GameScreen"),s=t.root.findByName("Maps");n.enabled=!0,i.enabled=!1;var o=this.entity.parent.script.mapsystem.currentLevel;switch(e.script.game.clearLevelGridHighlight(),o){case 1:var r=a.findByName("LevelMap");r.findByName("Stars").enabled=!1,r.findByName("StarsOn").enabled=!0,r.findByName("Endless Button").button.active=!0,n.findByName("Level 2 Button").enabled=!0,e.findByName("Destination Base 1").enabled=!1,s.findByName("1").enabled=!1;break;case 2:var p=a.findByName("LevelMap2");p.findByName("Stars").enabled=!1,p.findByName("StarsOn").enabled=!0,p.findByName("Endless Button").button.active=!0,n.findByName("Level 3 Button").enabled=!0,e.findByName("Destination Base 2").enabled=!1,s.findByName("2").enabled=!1;break;case 3:var c=a.findByName("LevelMap3");c.findByName("Stars").enabled=!1,c.findByName("StarsOn").enabled=!0,c.findByName("Endless Button").button.active=!0,n.findByName("Level 4 Button").enabled=!0,e.findByName("Destination Base 3").enabled=!1,s.findByName("3").enabled=!1;break;case 4:var d=a.findByName("LevelMap4");d.findByName("Stars").enabled=!1,d.findByName("StarsOn").enabled=!0,d.findByName("Endless Button").button.active=!0,n.findByName("Level 5 Button").enabled=!0,e.findByName("Destination Base 4").enabled=!1,s.findByName("4").enabled=!1;break;case 5:var m=a.findByName("LevelMap5");m.findByName("Stars").enabled=!1,m.findByName("StarsOn").enabled=!0,m.findByName("Endless Button").button.active=!0,n.findByName("Level 6 Button").enabled=!0,e.findByName("Destination Base 5").enabled=!1,s.findByName("5").enabled=!1;break;case 6:var h=a.findByName("LevelMap6");h.findByName("Stars").enabled=!1,h.findByName("StarsOn").enabled=!0,h.findByName("Endless Button").button.active=!0,e.findByName("Destination Base 6").enabled=!1,s.findByName("6").enabled=!1}for(var v=i.findByTag("Unit Selection"),l=0;l<v.length;l++)v[l].enabled=!1;t.root.findByName("Background Music").sound.stop(),e.script.game.saveGameState(o),this.entity.destroy()}},SpawnLocation.prototype.waveDone=function(){this.app.root.findByName("UI").findByName("Wave Done").enabled=!0},SpawnLocation.prototype.newWave=function(){this.app.root.findByName("UI").findByName("Wave Done").enabled=!1},SpawnLocation.prototype.getCurrentWave=function(){return this.currentWave},SpawnLocation.prototype.decreaseEnemyCount=function(){switch(this.currentWave){case 1:this.wave1--;break;case 2:this.wave2--;break;case 3:this.wave3--}},SpawnLocation.prototype.spawnEnemies=function(e,t){var a=this.app,n=a.root.findByName("Game"),i=n.findByName("Destination");if(t>0){if(i&&(this.timeToSpawn-=e,this.timeToSpawn<=0)){var s=a.root.findByName("Templates").findByName(this.robot).clone();this.entity.addChild(s),s.setPosition(this.entity.getPosition()),s.enabled=!0;var o=pc.math.clamp(1200-n.script.game.timer,0,1200)/1200;this.timeToSpawn=this.spawnInterval*o,this.spawnEndlessModeState()&&this.currentWave>3?this.decrementEndlessWaveSpawn():this.decreaseEnemyCount()}this.waveOverState(!1)}else!this.waveOver&&this.noRemainingEnemies()&&(!1===this.gameOverCheck()&&(this.waveDone(),this.waveOverState(!0),n.script.game.gamePauseState(!0),PokiSDK.gameplayStop(),n.script.game.resetUnitDeploy(),n.script.game.triggerCommercialBreak(!1,!1)),!1===this.gameOverCheck()&&this.currentWave>=3&&!this.spawnEndlessModeState()&&(this.newWave(),this.levelSuccess(!0)))},SpawnLocation.prototype.waveOverState=function(e){if(this.doubleSpawnCheck()){var t=this.spawnEntities();t[0].script.spawnLocation.waveOver=e,t[1].script.spawnLocation.waveOver=e}else this.waveOver=e},SpawnLocation.prototype.levelSuccess=function(e){var t,a=this.app.root.findByName("UI");switch(this.entity.parent.script.mapsystem.levelNumber()){case 1:t=a.findByName("LevelMap 1 Success");break;case 2:t=a.findByName("LevelMap 2 Success");break;case 3:t=a.findByName("LevelMap 3 Success");break;case 4:t=a.findByName("LevelMap 4 Success");break;case 5:t=a.findByName("LevelMap 5 Success");break;case 6:t=a.findByName("LevelMap 6 Success")}t.enabled=e},SpawnLocation.prototype.noRemainingEnemies=function(){var e=this.app.root.findByName("Game"),t=this.robot;return!(e.find("name",t).length>0)},SpawnLocation.prototype.gameOverCheck=function(){return this.app.root.findByName("Game").script.game.isGameOver};// tween.min.js
// tween.js - http://github.com/sole/tween.js
'use strict';void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});
var TWEEN=TWEEN||function(){var a=[];return{REVISION:"13",getAll:function(){return a},removeAll:function(){a=[]},add:function(c){a.push(c)},remove:function(c){c=a.indexOf(c);-1!==c&&a.splice(c,1)},update:function(c){if(0===a.length)return!1;for(var b=0,c=void 0!==c?c:"undefined"!==typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();b<a.length;)a[b].update(c)?b++:a.splice(b,1);return!0}}}();
TWEEN.Tween=function(a){var c={},b={},d={},e=1E3,g=0,h=!1,j=!1,q=0,m=null,w=TWEEN.Easing.Linear.None,x=TWEEN.Interpolation.Linear,n=[],r=null,s=!1,t=null,u=null,k=null,v;for(v in a)c[v]=parseFloat(a[v],10);this.to=function(a,c){void 0!==c&&(e=c);b=a;return this};this.start=function(e){TWEEN.add(this);j=!0;s=!1;m=void 0!==e?e:"undefined"!==typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();m+=q;for(var f in b){if(b[f]instanceof Array){if(0===
b[f].length)continue;b[f]=[a[f]].concat(b[f])}c[f]=a[f];!1===c[f]instanceof Array&&(c[f]*=1);d[f]=c[f]||0}return this};this.stop=function(){if(!j)return this;TWEEN.remove(this);j=!1;null!==k&&k.call(a);this.stopChainedTweens();return this};this.stopChainedTweens=function(){for(var a=0,b=n.length;a<b;a++)n[a].stop()};this.delay=function(a){q=a;return this};this.repeat=function(a){g=a;return this};this.yoyo=function(a){h=a;return this};this.easing=function(a){w=a;return this};this.interpolation=function(a){x=
a;return this};this.chain=function(){n=arguments;return this};this.onStart=function(a){r=a;return this};this.onUpdate=function(a){t=a;return this};this.onComplete=function(a){u=a;return this};this.onStop=function(a){k=a;return this};this.update=function(p){var f;if(p<m)return!0;!1===s&&(null!==r&&r.call(a),s=!0);var i=(p-m)/e,i=1<i?1:i,j=w(i);for(f in b){var k=c[f]||0,l=b[f];l instanceof Array?a[f]=x(l,j):("string"===typeof l&&(l=k+parseFloat(l,10)),"number"===typeof l&&(a[f]=k+(l-k)*j))}null!==t&&
t.call(a,j);if(1==i)if(0<g){isFinite(g)&&g--;for(f in d)"string"===typeof b[f]&&(d[f]+=parseFloat(b[f],10)),h&&(i=d[f],d[f]=b[f],b[f]=i),c[f]=d[f];m=p+q}else{null!==u&&u.call(a);f=0;for(i=n.length;f<i;f++)n[f].start(p);return!1}return!0}};
TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?0.5*a*a:-0.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?0.5*a*a*a:0.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?0.5*a*a*a*a:-0.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*
a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return 1>(a*=2)?0.5*a*a*a*a*a:0.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return 0.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?0.5*Math.pow(1024,a-1):0.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-
Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-0.5*(Math.sqrt(1-a*a)-1):0.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var c,b=0.1;if(0===a)return 0;if(1===a)return 1;!b||1>b?(b=1,c=0.1):c=0.4*Math.asin(1/b)/(2*Math.PI);return-(b*Math.pow(2,10*(a-=1))*Math.sin((a-c)*2*Math.PI/0.4))},Out:function(a){var c,b=0.1;if(0===a)return 0;if(1===a)return 1;!b||1>b?(b=1,c=0.1):c=0.4*Math.asin(1/b)/(2*Math.PI);return b*Math.pow(2,-10*a)*Math.sin((a-c)*
2*Math.PI/0.4)+1},InOut:function(a){var c,b=0.1;if(0===a)return 0;if(1===a)return 1;!b||1>b?(b=1,c=0.1):c=0.4*Math.asin(1/b)/(2*Math.PI);return 1>(a*=2)?-0.5*b*Math.pow(2,10*(a-=1))*Math.sin((a-c)*2*Math.PI/0.4):0.5*b*Math.pow(2,-10*(a-=1))*Math.sin((a-c)*2*Math.PI/0.4)+1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?0.5*a*a*(3.5949095*a-2.5949095):0.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-
TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+0.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375},InOut:function(a){return 0.5>a?0.5*TWEEN.Easing.Bounce.In(2*a):0.5*TWEEN.Easing.Bounce.Out(2*a-1)+0.5}}};
TWEEN.Interpolation={Linear:function(a,c){var b=a.length-1,d=b*c,e=Math.floor(d),g=TWEEN.Interpolation.Utils.Linear;return 0>c?g(a[0],a[1],d):1<c?g(a[b],a[b-1],b-d):g(a[e],a[e+1>b?b:e+1],d-e)},Bezier:function(a,c){var b=0,d=a.length-1,e=Math.pow,g=TWEEN.Interpolation.Utils.Bernstein,h;for(h=0;h<=d;h++)b+=e(1-c,d-h)*e(c,h)*a[h]*g(d,h);return b},CatmullRom:function(a,c){var b=a.length-1,d=b*c,e=Math.floor(d),g=TWEEN.Interpolation.Utils.CatmullRom;return a[0]===a[b]?(0>c&&(e=Math.floor(d=b*(1+c))),g(a[(e-
1+b)%b],a[e],a[(e+1)%b],a[(e+2)%b],d-e)):0>c?a[0]-(g(a[0],a[0],a[1],a[1],-d)-a[0]):1<c?a[b]-(g(a[b],a[b],a[b-1],a[b-1],d-b)-a[b]):g(a[e?e-1:0],a[e],a[b<e+1?b:e+1],a[b<e+2?b:e+2],d-e)},Utils:{Linear:function(a,c,b){return(c-a)*b+a},Bernstein:function(a,c){var b=TWEEN.Interpolation.Utils.Factorial;return b(a)/b(c)/b(a-c)},Factorial:function(){var a=[1];return function(c){var b=1,d;if(a[c])return a[c];for(d=c;1<d;d--)b*=d;return a[c]=b}}(),CatmullRom:function(a,c,b,d,e){var a=0.5*(b-a),d=0.5*(d-c),g=
e*e;return(2*c-2*b+a+d)*e*g+(-3*c+3*b-2*a-d)*g+a*e+c}}};

// pathfinding.min.js
!function(t){if("function"==typeof bootstrap)bootstrap("pf",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makePF=t}else"undefined"!=typeof window?window.PF=t():global.PF=t()}(function(){return function(t,e,r){function i(r,o){if(!e[r]){if(!t[r]){var s="function"==typeof require&&require;if(!o&&s)return s(r,!0);if(n)return n(r,!0);throw new Error("Cannot find module '"+r+"'")}var a=e[r]={exports:{}};t[r][0].call(a.exports,function(e){var n=t[r][1][e];return i(n?n:e)},a,a.exports)}return e[r].exports}for(var n="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,e){e.exports=t("./lib/heap")},{"./lib/heap":2}],2:[function(t,e){!function(){var t,r,i,n,o,s,a,u,h,l,p,c,f,d,g;i=Math.floor,l=Math.min,r=function(t,e){return e>t?-1:t>e?1:0},h=function(t,e,n,o,s){var a;if(null==n&&(n=0),null==s&&(s=r),0>n)throw new Error("lo must be non-negative");for(null==o&&(o=t.length);o>n;)a=i((n+o)/2),s(e,t[a])<0?o=a:n=a+1;return[].splice.apply(t,[n,n-n].concat(e)),e},s=function(t,e,i){return null==i&&(i=r),t.push(e),d(t,0,t.length-1,i)},o=function(t,e){var i,n;return null==e&&(e=r),i=t.pop(),t.length?(n=t[0],t[0]=i,g(t,0,e)):n=i,n},u=function(t,e,i){var n;return null==i&&(i=r),n=t[0],t[0]=e,g(t,0,i),n},a=function(t,e,i){var n;return null==i&&(i=r),t.length&&i(t[0],e)<0&&(n=[t[0],e],e=n[0],t[0]=n[1],g(t,0,i)),e},n=function(t,e){var n,o,s,a,u,h;for(null==e&&(e=r),a=function(){h=[];for(var e=0,r=i(t.length/2);r>=0?r>e:e>r;r>=0?e++:e--)h.push(e);return h}.apply(this).reverse(),u=[],o=0,s=a.length;s>o;o++)n=a[o],u.push(g(t,n,e));return u},f=function(t,e,i){var n;return null==i&&(i=r),n=t.indexOf(e),-1!==n?(d(t,0,n,i),g(t,n,i)):void 0},p=function(t,e,i){var o,s,u,h,l;if(null==i&&(i=r),s=t.slice(0,e),!s.length)return s;for(n(s,i),l=t.slice(e),u=0,h=l.length;h>u;u++)o=l[u],a(s,o,i);return s.sort(i).reverse()},c=function(t,e,i){var s,a,u,p,c,f,d,g,b,y;if(null==i&&(i=r),10*e<=t.length){if(p=t.slice(0,e).sort(i),!p.length)return p;for(u=p[p.length-1],g=t.slice(e),c=0,d=g.length;d>c;c++)s=g[c],i(s,u)<0&&(h(p,s,0,null,i),p.pop(),u=p[p.length-1]);return p}for(n(t,i),y=[],a=f=0,b=l(e,t.length);b>=0?b>f:f>b;a=b>=0?++f:--f)y.push(o(t,i));return y},d=function(t,e,i,n){var o,s,a;for(null==n&&(n=r),o=t[i];i>e&&(a=i-1>>1,s=t[a],n(o,s)<0);)t[i]=s,i=a;return t[i]=o},g=function(t,e,i){var n,o,s,a,u;for(null==i&&(i=r),o=t.length,u=e,s=t[e],n=2*e+1;o>n;)a=n+1,o>a&&!(i(t[n],t[a])<0)&&(n=a),t[e]=t[n],e=n,n=2*e+1;return t[e]=s,d(t,u,e,i)},t=function(){function t(t){this.cmp=null!=t?t:r,this.nodes=[]}return t.push=s,t.pop=o,t.replace=u,t.pushpop=a,t.heapify=n,t.nlargest=p,t.nsmallest=c,t.prototype.push=function(t){return s(this.nodes,t,this.cmp)},t.prototype.pop=function(){return o(this.nodes,this.cmp)},t.prototype.peek=function(){return this.nodes[0]},t.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)},t.prototype.replace=function(t){return u(this.nodes,t,this.cmp)},t.prototype.pushpop=function(t){return a(this.nodes,t,this.cmp)},t.prototype.heapify=function(){return n(this.nodes,this.cmp)},t.prototype.updateItem=function(t){return f(this.nodes,t,this.cmp)},t.prototype.clear=function(){return this.nodes=[]},t.prototype.empty=function(){return 0===this.nodes.length},t.prototype.size=function(){return this.nodes.length},t.prototype.clone=function(){var e;return e=new t,e.nodes=this.nodes.slice(0),e},t.prototype.toArray=function(){return this.nodes.slice(0)},t.prototype.insert=t.prototype.push,t.prototype.remove=t.prototype.pop,t.prototype.top=t.prototype.peek,t.prototype.front=t.prototype.peek,t.prototype.has=t.prototype.contains,t.prototype.copy=t.prototype.clone,t}(),("undefined"!=typeof e&&null!==e?e.exports:void 0)?e.exports=t:window.Heap=t}.call(this)},{}],3:[function(t,e){e.exports={Heap:t("heap"),Node:t("./core/Node"),Grid:t("./core/Grid"),Util:t("./core/Util"),Heuristic:t("./core/Heuristic"),AStarFinder:t("./finders/AStarFinder"),BestFirstFinder:t("./finders/BestFirstFinder"),BreadthFirstFinder:t("./finders/BreadthFirstFinder"),DijkstraFinder:t("./finders/DijkstraFinder"),BiAStarFinder:t("./finders/BiAStarFinder"),BiBestFirstFinder:t("./finders/BiBestFirstFinder"),BiBreadthFirstFinder:t("./finders/BiBreadthFirstFinder"),BiDijkstraFinder:t("./finders/BiDijkstraFinder"),IDAStarFinder:t("./finders/IDAStarFinder"),JumpPointFinder:t("./finders/JumpPointFinder"),OrthogonalJumpPointFinder:t("./finders/OrthogonalJumpPointFinder"),TraceFinder:t("./finders/TraceFinder")}},{"./core/Grid":4,"./core/Heuristic":5,"./core/Node":6,"./core/Util":7,"./finders/AStarFinder":8,"./finders/BestFirstFinder":9,"./finders/BiAStarFinder":10,"./finders/BiBestFirstFinder":11,"./finders/BiBreadthFirstFinder":12,"./finders/BiDijkstraFinder":13,"./finders/BreadthFirstFinder":14,"./finders/DijkstraFinder":15,"./finders/IDAStarFinder":16,"./finders/JumpPointFinder":17,"./finders/OrthogonalJumpPointFinder":18,"./finders/TraceFinder":19,heap:1}],4:[function(t,e){function r(t,e,r){this.width=t,this.height=e,this.nodes=this._buildNodes(t,e,r)}var i=t("./Node");r.prototype._buildNodes=function(t,e,r){var n,o,s=new Array(e);for(n=0;e>n;++n)for(s[n]=new Array(t),o=0;t>o;++o)s[n][o]=new i(o,n);if(void 0===r)return s;if(r.length!==e||r[0].length!==t)throw new Error("Matrix size does not fit");for(n=0;e>n;++n)for(o=0;t>o;++o)r[n][o]&&(s[n][o].walkable=!1);return s},r.prototype.getNodeAt=function(t,e){return this.nodes[e][t]},r.prototype.isWalkableAt=function(t,e){return this.isInside(t,e)&&this.nodes[e][t].walkable},r.prototype.isInside=function(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height},r.prototype.setWalkableAt=function(t,e,r){this.nodes[e][t].walkable=r},r.prototype.getNeighbors=function(t,e,r){var i=t.x,n=t.y,o=[],s=!1,a=!1,u=!1,h=!1,l=!1,p=!1,c=!1,f=!1,d=this.nodes;return this.isWalkableAt(i,n-1)&&(o.push(d[n-1][i]),s=!0),this.isWalkableAt(i+1,n)&&(o.push(d[n][i+1]),u=!0),this.isWalkableAt(i,n+1)&&(o.push(d[n+1][i]),l=!0),this.isWalkableAt(i-1,n)&&(o.push(d[n][i-1]),c=!0),e?(r?(a=c&&s,h=s&&u,p=u&&l,f=l&&c):(a=c||s,h=s||u,p=u||l,f=l||c),a&&this.isWalkableAt(i-1,n-1)&&o.push(d[n-1][i-1]),h&&this.isWalkableAt(i+1,n-1)&&o.push(d[n-1][i+1]),p&&this.isWalkableAt(i+1,n+1)&&o.push(d[n+1][i+1]),f&&this.isWalkableAt(i-1,n+1)&&o.push(d[n+1][i-1]),o):o},r.prototype.clone=function(){var t,e,n=this.width,o=this.height,s=this.nodes,a=new r(n,o),u=new Array(o);for(t=0;o>t;++t)for(u[t]=new Array(n),e=0;n>e;++e)u[t][e]=new i(e,t,s[t][e].walkable);return a.nodes=u,a},e.exports=r},{"./Node":6}],5:[function(t,e){e.exports={manhattan:function(t,e){return t+e},euclidean:function(t,e){return Math.sqrt(t*t+e*e)},chebyshev:function(t,e){return Math.max(t,e)}}},{}],6:[function(t,e){function r(t,e,r){this.x=t,this.y=e,this.walkable=void 0===r?!0:r}e.exports=r},{}],7:[function(t,e,r){function i(t){for(var e=[[t.x,t.y]];t.parent;)t=t.parent,e.push([t.x,t.y]);return e.reverse()}function n(t,e){var r=i(t),n=i(e);return r.concat(n.reverse())}function o(t){var e,r,i,n,o,s=0;for(e=1;e<t.length;++e)r=t[e-1],i=t[e],n=r[0]-i[0],o=r[1]-i[1],s+=Math.sqrt(n*n+o*o);return s}function s(t,e,r,i){var n,o,s,a,u,h,l=Math.abs,p=[];for(s=l(r-t),a=l(i-e),n=r>t?1:-1,o=i>e?1:-1,u=s-a;;){if(p.push([t,e]),t===r&&e===i)break;h=2*u,h>-a&&(u-=a,t+=n),s>h&&(u+=s,e+=o)}return p}function a(t){var e,r,i,n,o,a,u=[],h=t.length;if(2>h)return u;for(o=0;h-1>o;++o)for(e=t[o],r=t[o+1],i=s(e[0],e[1],r[0],r[1]),n=i.length,a=0;n-1>a;++a)u.push(i[a]);return u.push(t[h-1]),u}function u(t,e){var r,i,n,o,a,u,h,l,p,c,f,d,g,b=e.length,y=e[0][0],A=e[0][1],k=e[b-1][0],m=e[b-1][1];for(r=y,i=A,a=e[1][0],u=e[1][1],h=[[r,i]],l=2;b>l;++l){for(c=e[l],n=c[0],o=c[1],f=s(r,i,n,o),g=!1,p=1;p<f.length;++p)if(d=f[p],!t.isWalkableAt(d[0],d[1])){g=!0,h.push([a,u]),r=a,i=u;break}g||(a=n,u=o)}return h.push([k,m]),h}function h(t){if(t.length<3)return t;var e,r,i,n,o,s,a=[],u=t[0][0],h=t[0][1],l=t[1][0],p=t[1][1],c=l-u,f=p-h;for(o=Math.sqrt(c*c+f*f),c/=o,f/=o,a.push([u,h]),s=2;s<t.length;s++)e=l,r=p,i=c,n=f,l=t[s][0],p=t[s][1],c=l-e,f=p-r,o=Math.sqrt(c*c+f*f),c/=o,f/=o,(c!==i||f!==n)&&a.push([e,r]);return a.push([l,p]),a}r.backtrace=i,r.biBacktrace=n,r.pathLength=o,r.interpolate=s,r.expandPath=a,r.smoothenPath=u,r.compressPath=h},{}],8:[function(t,e){function r(t){t=t||{},this.allowDiagonal=t.allowDiagonal,this.dontCrossCorners=t.dontCrossCorners,this.heuristic=t.heuristic||o.manhattan,this.weight=t.weight||1}var i=t("heap"),n=t("../core/Util"),o=t("../core/Heuristic");r.prototype.findPath=function(t,e,r,o,s){var a,u,h,l,p,c,f,d,g=new i(function(t,e){return t.f-e.f}),b=s.getNodeAt(t,e),y=s.getNodeAt(r,o),A=this.heuristic,k=this.allowDiagonal,m=this.dontCrossCorners,v=this.weight,w=Math.abs,x=Math.SQRT2;for(b.g=0,b.f=0,g.push(b),b.opened=!0;!g.empty();){if(a=g.pop(),a.closed=!0,a===y)return n.backtrace(y);for(u=s.getNeighbors(a,k,m),l=0,p=u.length;p>l;++l)h=u[l],h.closed||(c=h.x,f=h.y,d=a.g+(0===c-a.x||0===f-a.y?1:x),(!h.opened||d<h.g)&&(h.g=d,h.h=h.h||v*A(w(c-r),w(f-o)),h.f=h.g+h.h,h.parent=a,h.opened?g.updateItem(h):(g.push(h),h.opened=!0)))}return[]},e.exports=r},{"../core/Heuristic":5,"../core/Util":7,heap:1}],9:[function(t,e){function r(t){i.call(this,t);var e=this.heuristic;this.heuristic=function(t,r){return 1e6*e(t,r)}}var i=t("./AStarFinder");r.prototype=new i,r.prototype.constructor=r,e.exports=r},{"./AStarFinder":8}],10:[function(t,e){function r(t){t=t||{},this.allowDiagonal=t.allowDiagonal,this.dontCrossCorners=t.dontCrossCorners,this.heuristic=t.heuristic||o.manhattan,this.weight=t.weight||1}var i=t("heap"),n=t("../core/Util"),o=t("../core/Heuristic");r.prototype.findPath=function(t,e,r,o,s){var a,u,h,l,p,c,f,d,g=function(t,e){return t.f-e.f},b=new i(g),y=new i(g),A=s.getNodeAt(t,e),k=s.getNodeAt(r,o),m=this.heuristic,v=this.allowDiagonal,w=this.dontCrossCorners,x=this.weight,F=Math.abs,W=Math.SQRT2,N=1,C=2;for(A.g=0,A.f=0,b.push(A),A.opened=N,k.g=0,k.f=0,y.push(k),k.opened=C;!b.empty()&&!y.empty();){for(a=b.pop(),a.closed=!0,u=s.getNeighbors(a,v,w),l=0,p=u.length;p>l;++l)if(h=u[l],!h.closed){if(h.opened===C)return n.biBacktrace(a,h);c=h.x,f=h.y,d=a.g+(0===c-a.x||0===f-a.y?1:W),(!h.opened||d<h.g)&&(h.g=d,h.h=h.h||x*m(F(c-r),F(f-o)),h.f=h.g+h.h,h.parent=a,h.opened?b.updateItem(h):(b.push(h),h.opened=N))}for(a=y.pop(),a.closed=!0,u=s.getNeighbors(a,v,w),l=0,p=u.length;p>l;++l)if(h=u[l],!h.closed){if(h.opened===N)return n.biBacktrace(h,a);c=h.x,f=h.y,d=a.g+(0===c-a.x||0===f-a.y?1:W),(!h.opened||d<h.g)&&(h.g=d,h.h=h.h||x*m(F(c-t),F(f-e)),h.f=h.g+h.h,h.parent=a,h.opened?y.updateItem(h):(y.push(h),h.opened=C))}}return[]},e.exports=r},{"../core/Heuristic":5,"../core/Util":7,heap:1}],11:[function(t,e){function r(t){i.call(this,t);var e=this.heuristic;this.heuristic=function(t,r){return 1e6*e(t,r)}}var i=t("./BiAStarFinder");r.prototype=new i,r.prototype.constructor=r,e.exports=r},{"./BiAStarFinder":10}],12:[function(t,e){function r(t){t=t||{},this.allowDiagonal=t.allowDiagonal,this.dontCrossCorners=t.dontCrossCorners}var i=t("../core/Util");r.prototype.findPath=function(t,e,r,n,o){var s,a,u,h,l,p=o.getNodeAt(t,e),c=o.getNodeAt(r,n),f=[],d=[],g=this.allowDiagonal,b=this.dontCrossCorners,y=0,A=1;for(f.push(p),p.opened=!0,p.by=y,d.push(c),c.opened=!0,c.by=A;f.length&&d.length;){for(u=f.shift(),u.closed=!0,s=o.getNeighbors(u,g,b),h=0,l=s.length;l>h;++h)if(a=s[h],!a.closed)if(a.opened){if(a.by===A)return i.biBacktrace(u,a)}else f.push(a),a.parent=u,a.opened=!0,a.by=y;for(u=d.shift(),u.closed=!0,s=o.getNeighbors(u,g,b),h=0,l=s.length;l>h;++h)if(a=s[h],!a.closed)if(a.opened){if(a.by===y)return i.biBacktrace(a,u)}else d.push(a),a.parent=u,a.opened=!0,a.by=A}return[]},e.exports=r},{"../core/Util":7}],13:[function(t,e){function r(t){i.call(this,t),this.heuristic=function(){return 0}}var i=t("./BiAStarFinder");r.prototype=new i,r.prototype.constructor=r,e.exports=r},{"./BiAStarFinder":10}],14:[function(t,e){function r(t){t=t||{},this.allowDiagonal=t.allowDiagonal,this.dontCrossCorners=t.dontCrossCorners}var i=t("../core/Util");r.prototype.findPath=function(t,e,r,n,o){var s,a,u,h,l,p=[],c=this.allowDiagonal,f=this.dontCrossCorners,d=o.getNodeAt(t,e),g=o.getNodeAt(r,n);for(p.push(d),d.opened=!0;p.length;){if(u=p.shift(),u.closed=!0,u===g)return i.backtrace(g);for(s=o.getNeighbors(u,c,f),h=0,l=s.length;l>h;++h)a=s[h],a.closed||a.opened||(p.push(a),a.opened=!0,a.parent=u)}return[]},e.exports=r},{"../core/Util":7}],15:[function(t,e){function r(t){i.call(this,t),this.heuristic=function(){return 0}}var i=t("./AStarFinder");r.prototype=new i,r.prototype.constructor=r,e.exports=r},{"./AStarFinder":8}],16:[function(t,e){function r(t){t=t||{},this.allowDiagonal=t.allowDiagonal,this.dontCrossCorners=t.dontCrossCorners,this.heuristic=t.heuristic||i.manhattan,this.weight=t.weight||1,this.trackRecursion=t.trackRecursion||!1,this.timeLimit=t.timeLimit||1/0}t("../core/Util");var i=t("../core/Heuristic"),n=t("../core/Node");r.prototype.findPath=function(t,e,r,i,o){var s,a,u,h=0,l=(new Date).getTime(),p=function(t,e){return this.heuristic(Math.abs(e.x-t.x),Math.abs(e.y-t.y))}.bind(this),c=function(t,e){return t.x===e.x||t.y===e.y?1:Math.SQRT2},f=function(t,e,r,i,s){if(h++,this.timeLimit>0&&(new Date).getTime()-l>1e3*this.timeLimit)return 1/0;var a=e+p(t,g)*this.weight;if(a>r)return a;if(t==g)return i[s]=[t.x,t.y],t;var u,d,b,y,A=o.getNeighbors(t,this.allowDiagonal,this.dontCrossCorners);for(b=0,u=1/0;y=A[b];++b){if(this.trackRecursion&&(y.retainCount=y.retainCount+1||1,y.tested!==!0&&(y.tested=!0)),d=f(y,e+c(t,y),r,i,s+1),d instanceof n)return i[s]=[t.x,t.y],d;this.trackRecursion&&0===--y.retainCount&&(y.tested=!1),u>d&&(u=d)}return u}.bind(this),d=o.getNodeAt(t,e),g=o.getNodeAt(r,i),b=p(d,g);for(s=0;!0;++s){if(a=[],u=f(d,0,b,a,0),1/0===u)return[];if(u instanceof n)return a;b=u}return[]},e.exports=r},{"../core/Heuristic":5,"../core/Node":6,"../core/Util":7}],17:[function(t,e){function r(t){t=t||{},this.heuristic=t.heuristic||o.manhattan,this.trackJumpRecursion=t.trackJumpRecursion||!1}var i=t("heap"),n=t("../core/Util"),o=t("../core/Heuristic");r.prototype.findPath=function(t,e,r,o,s){var a,u=this.openList=new i(function(t,e){return t.f-e.f}),h=this.startNode=s.getNodeAt(t,e),l=this.endNode=s.getNodeAt(r,o);for(this.grid=s,h.g=0,h.f=0,u.push(h),h.opened=!0;!u.empty();){if(a=u.pop(),a.closed=!0,a===l)return n.expandPath(n.backtrace(l));this._identifySuccessors(a)}return[]},r.prototype._identifySuccessors=function(t){var e,r,i,n,s,a,u,h,l,p,c=this.grid,f=this.heuristic,d=this.openList,g=this.endNode.x,b=this.endNode.y,y=t.x,A=t.y,k=Math.abs;for(Math.max,e=this._findNeighbors(t),n=0,s=e.length;s>n;++n)if(r=e[n],i=this._jump(r[0],r[1],y,A)){if(a=i[0],u=i[1],p=c.getNodeAt(a,u),p.closed)continue;h=o.euclidean(k(a-y),k(u-A)),l=t.g+h,(!p.opened||l<p.g)&&(p.g=l,p.h=p.h||f(k(a-g),k(u-b)),p.f=p.g+p.h,p.parent=t,p.opened?d.updateItem(p):(d.push(p),p.opened=!0))}},r.prototype._jump=function(t,e,r,i){var n=this.grid,o=t-r,s=e-i;if(!n.isWalkableAt(t,e))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(t,e).tested=!0),n.getNodeAt(t,e)===this.endNode)return[t,e];if(0!==o&&0!==s){if(n.isWalkableAt(t-o,e+s)&&!n.isWalkableAt(t-o,e)||n.isWalkableAt(t+o,e-s)&&!n.isWalkableAt(t,e-s))return[t,e]}else if(0!==o){if(n.isWalkableAt(t+o,e+1)&&!n.isWalkableAt(t,e+1)||n.isWalkableAt(t+o,e-1)&&!n.isWalkableAt(t,e-1))return[t,e]}else if(n.isWalkableAt(t+1,e+s)&&!n.isWalkableAt(t+1,e)||n.isWalkableAt(t-1,e+s)&&!n.isWalkableAt(t-1,e))return[t,e];return 0!==o&&0!==s&&(this._jump(t+o,e,t,e)||this._jump(t,e+s,t,e))?[t,e]:n.isWalkableAt(t+o,e)||n.isWalkableAt(t,e+s)?this._jump(t+o,e+s,t,e):null},r.prototype._findNeighbors=function(t){var e,r,i,n,o,s,a,u,h=t.parent,l=t.x,p=t.y,c=this.grid,f=[];if(h)e=h.x,r=h.y,i=(l-e)/Math.max(Math.abs(l-e),1),n=(p-r)/Math.max(Math.abs(p-r),1),0!==i&&0!==n?(c.isWalkableAt(l,p+n)&&f.push([l,p+n]),c.isWalkableAt(l+i,p)&&f.push([l+i,p]),(c.isWalkableAt(l,p+n)||c.isWalkableAt(l+i,p))&&f.push([l+i,p+n]),!c.isWalkableAt(l-i,p)&&c.isWalkableAt(l,p+n)&&f.push([l-i,p+n]),!c.isWalkableAt(l,p-n)&&c.isWalkableAt(l+i,p)&&f.push([l+i,p-n])):0===i?c.isWalkableAt(l,p+n)&&(f.push([l,p+n]),c.isWalkableAt(l+1,p)||f.push([l+1,p+n]),c.isWalkableAt(l-1,p)||f.push([l-1,p+n])):c.isWalkableAt(l+i,p)&&(f.push([l+i,p]),c.isWalkableAt(l,p+1)||f.push([l+i,p+1]),c.isWalkableAt(l,p-1)||f.push([l+i,p-1]));else for(o=c.getNeighbors(t,!0),a=0,u=o.length;u>a;++a)s=o[a],f.push([s.x,s.y]);return f},e.exports=r},{"../core/Heuristic":5,"../core/Util":7,heap:1}],18:[function(t,e){function r(t){n.call(this,t),t=t||{},this.heuristic=t.heuristic||i.manhattan}var i=t("../core/Heuristic"),n=t("./JumpPointFinder");r.prototype=new n,r.prototype.constructor=r,r.prototype._jump=function(t,e,r,i){var n=this.grid,o=t-r,s=e-i;if(!n.isWalkableAt(t,e))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(t,e).tested=!0),n.getNodeAt(t,e)===this.endNode)return[t,e];if(0!==o){if(n.isWalkableAt(t,e-1)&&!n.isWalkableAt(t-o,e-1)||n.isWalkableAt(t,e+1)&&!n.isWalkableAt(t-o,e+1))return[t,e]}else{if(0===s)throw new Error("Only horizontal and vertical movements are allowed");if(n.isWalkableAt(t-1,e)&&!n.isWalkableAt(t-1,e-s)||n.isWalkableAt(t+1,e)&&!n.isWalkableAt(t+1,e-s))return[t,e];if(this._jump(t+1,e,t,e)||this._jump(t-1,e,t,e))return[t,e]}return this._jump(t+o,e+s,t,e)},r.prototype._findNeighbors=function(t){var e,r,i,n,o,s,a,u,h=t.parent,l=t.x,p=t.y,c=this.grid,f=[];if(h)e=h.x,r=h.y,i=(l-e)/Math.max(Math.abs(l-e),1),n=(p-r)/Math.max(Math.abs(p-r),1),0!==i?(c.isWalkableAt(l,p-1)&&f.push([l,p-1]),c.isWalkableAt(l,p+1)&&f.push([l,p+1]),c.isWalkableAt(l+i,p)&&f.push([l+i,p])):0!==n&&(c.isWalkableAt(l-1,p)&&f.push([l-1,p]),c.isWalkableAt(l+1,p)&&f.push([l+1,p]),c.isWalkableAt(l,p+n)&&f.push([l,p+n]));else for(o=c.getNeighbors(t,!1),a=0,u=o.length;u>a;++a)s=o[a],f.push([s.x,s.y]);return f},e.exports=r},{"../core/Heuristic":5,"./JumpPointFinder":17}],19:[function(t,e){function r(t){t=t||{},this.allowDiagonal=t.allowDiagonal,this.dontCrossCorners=t.dontCrossCorners,this.heuristic=t.heuristic||o.manhattan}var i=t("heap"),n=t("../core/Util"),o=t("../core/Heuristic");r.prototype.findPath=function(t,e,r,o,s){var a,u,h,l,p,c,f,d,g=new i(function(t,e){return t.f-e.f}),b=s.getNodeAt(t,e),y=s.getNodeAt(r,o),A=this.heuristic,k=this.allowDiagonal,m=this.dontCrossCorners,v=Math.abs,w=Math.SQRT2;for(b.g=0,b.f=0,g.push(b),b.opened=!0;!g.empty();){if(a=g.pop(),a.closed=!0,a===y)return n.backtrace(y);u=s.getNeighbors(a,k,m);var x=u.length;for(l=0,p=u.length;p>l;++l)h=u[l],h.closed||(c=h.x,f=h.y,d=a.g+(0===c-a.x||0===f-a.y?1:w),(!h.opened||d<h.g)&&(h.g=d*x/9,h.h=h.h||A(v(c-r),v(f-o)),h.f=h.g+h.h,h.parent=a,h.opened?g.updateItem(h):(g.push(h),h.opened=!0)))}return[]},e.exports=r},{"../core/Heuristic":5,"../core/Util":7,heap:1}]},{},[3])(3)});

var Game=pc.createScript("game");Game.attributes.add("initialResources",{type:"number",default:500}),Game.attributes.add("resourceIncrement",{type:"number",default:50}),Game.attributes.add("resourceInterval",{type:"number",default:10}),Game.attributes.add("watchAdButton",{type:"entity"}),Game.attributes.add("bonusRewardHudTimer",{type:"entity"}),Game.attributes.add("bonusRewardHudBtn",{type:"entity"}),Game.attributes.add("bonusRewardTxt",{type:"entity"}),Game.attributes.add("watchAdSpeedButton",{type:"entity"}),Game.attributes.add("speedBonusRewardHudTimer",{type:"entity"}),Game.attributes.add("speedBonusRewardHudBtn",{type:"entity"}),Game.attributes.add("speedBonusRewardTxt",{type:"entity"}),Game.attributes.add("watchAdInterface",{type:"entity"}),Game.attributes.add("speedUpWatchAdInterface",{type:"entity"}),Game.attributes.add("chestsInterface",{type:"entity"}),Game.attributes.add("commonButtonReward",{type:"entity"}),Game.attributes.add("rareButtonReward",{type:"entity"}),Game.attributes.add("epicButtonReward",{type:"entity"}),Game.attributes.add("commonRewardCollectWindow",{type:"entity"}),Game.attributes.add("rareRewardCollectWindow",{type:"entity"}),Game.attributes.add("epicRewardCollectWindow",{type:"entity"}),Game.attributes.add("placementMaterial",{type:"asset",assetType:"material"}),Game.attributes.add("tutorial",{type:"entity"}),Game.attributes.add("showingAd",{type:"boolean",default:!1}),Game.attributes.add("sceneName",{type:"string",default:"",title:"Scene to load:"}),Game.attributes.add("sellButton",{type:"entity"}),Game.attributes.add("remainingHP",{type:"entity"}),Game.attributes.add("enemiesLeft",{type:"entity"}),Game.attributes.add("wavesLeft",{type:"entity"}),Game.attributes.add("quitMenu",{type:"entity"}),Game.prototype.initialize=function(){var e=document.createElement("script");e.setAttribute("src","./sdk.js"),e.setAttribute("type","text/javascript"),document.head.appendChild(e);var t=this;e.addEventListener("load",(function(e){t.initializePoki()})),this.storageFactory=this.entity.script.storageFactory,this.loadGameState(),t.calculateDimensions(),window.addEventListener("orientationchange",(function(){var e=t.app.root.findByName("UI").findByName("Orientation Tutorial"),i=window.innerWidth,n=window.innerHeight;console.log(i+" : "+n),i>n?(e.enabled=!1,t.app.timeScale=1):(e.enabled=!0,t.app.timeScale=0)}),!1),window.addEventListener("resize",(function(){var e=t.app.root.findByName("UI").findByName("Orientation Tutorial"),i=window.innerWidth,n=window.innerHeight;console.log(i+" : "+n),i>n?(e.enabled=!1,t.app.timeScale=1):(e.enabled=!0,t.app.timeScale=0)}),!1),this.bonusRewardTimer=18e4,this.speedUpBonusRewardTimer=18e4,this.speedingUpTimer=0,this.bonusCommonChestTimer=3e5,this.bonusRareChestTimer=3e5,this.bonusEpicChestTimer=3e5,this.rareChestAdCounter=2,this.epicChestAdCounter=3,this.rareChestCooldownTimer=6e5,this.epicChestCooldownTimer=6e5,this.freeCannon1Reward=!1,this.freeCannon2Reward=!1,this.unitToDeploy=null,this.unitToDeployBlueprint=null,this.enemies=[],this.timer=0,this.resources=500,this.isGameOver=!1,this.intro=!0,this.gamePause=!0,this.speedBonusRewardHudBtn.button.active=!1;var i=this.app;i.root.findByName("Templates");this.watchAdButton.button.on("click",this.onAd,this),this.watchAdSpeedButton.button.on("click",this.onAdSpeedUp,this),this.commonButtonReward.button.on("click",this.onAdCommonChest,this),this.rareButtonReward.button.on("click",this.onAdRareChest,this),this.epicButtonReward.button.on("click",this.onAdEpicChest,this),this.lastTouch=new pc.Vec2(0,0),null!==this.app.touch&&i.touch.on(pc.EVENT_TOUCHSTART,(function(e){this.onMouseDown(this.getTouch(e),!0)}),this),i.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),i.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),i.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),window.addEventListener("blur",(function(){t.app.timeScale=0})),window.addEventListener("focus",(function(){t.getSpeedUpState();t.speedingUp?t.app.timeScale=2:this.gamePause?t.app.timeScale=0:t.app.timeScale=1,t.quitMenu.enabled=!1,t.gamePauseState(!1)})),this.cameraEntity=this.findCamera(),i.mouse.disableContextMenu(),this.ray=new pc.Ray,this.unitToSellPosition=new pc.Vec3,this.dragState=!1,this.mobileDragState=!1,this.speedingUp=!1,this.sellButtonHover=!1,this.initialPositionSaved=!1,this.initialPosition=new pc.Vec3,this.initialPositionX=null,this.initialPositionY=null,this.initialPositionType=null,this.firstYellow2=!0,this.firstYellow3=!0,this.firstBlack2=!0,this.firstBlack3=!0,this.firstBlue2=!0,this.firstBlue3=!0,this.firstWhite2=!0,this.firstWhite3=!0,this.firstRed2=!0,this.firstRed3=!0,this.firstGreen2=!0,this.firstGreen3=!0,this.gameEndless=!1,this.endlessRobotHp=0,this.endlessRobotSpeed=0,this.firstTutorialShowcase=!0,this.firstMerge=!0,this.mergeCount=0,this.firstSpeedLockedGame=!0,this.getSpotlightChildren=!1,this.hpElement=this.remainingHP.element.width,this.currentHealth=100,this.incrementEnemiesLeft=0,this.iconClicked=!1,this.firstSpeedUpTutorial=!0,this.newGame(),this.rewardTimer(),this.speedRewardTimer(),this.commonChestTimer(),this.rareChestTimer(),this.epicChestTimer(),this.opaqueMaterial()},Game.prototype.initializePoki=function(){this.app.systems.sound.volume=0,PokiSDK.init().then((()=>{console.log("Poki SDK successfully initialized"),PokiSDK.gameLoadingStart(),PokiSDK.gameLoadingFinished()}),this).catch((()=>{console.log("Initialized, but the user likely has adblock"),PokiSDK.gameLoadingStart(),PokiSDK.gameLoadingFinished()}))},Game.prototype.opaqueMaterial=function(){const e=new pc.StandardMaterial(this.placementMaterial);e.metalness=0,e.blendType=pc.BLEND_NORMAL,e.alphaWrite=!1,e.update()},Game.prototype.update=function(e){if(!this.isGameOver){var t=this.app.root.findByName("UI"),i=Math.floor(this.resources/1e3),n=t.findByName("Resources Display");this.resources>9999?n.element.text=i+"K":n.element.text=""+this.resources,this.iconClicked?this.gridHighlightState(!0):this.gridHighlightState(!1)}},Game.prototype.calculateDimensions=function(){var e=this.app,t=e.root.findByName("UI").findByName("Orientation Tutorial"),i=window.innerWidth,n=window.innerHeight;console.log(i+" : "+n),i>n?(t.enabled=!1,e.timeScale=1):(t.enabled=!0,e.timeScale=0)},Game.prototype.setGameEndlessModeState=function(e){console.log("setGameEndlessState: "+e),this.gameEndless=e},Game.prototype.gameEndlessModeState=function(){return this.gameEndless},Game.prototype.clearLevelGridHighlight=function(){var e=this.entity.findByName("Level Grid");e&&e.destroy()},Game.prototype.gridHighlightState=function(e){var t=this.entity.findByName("Level Grid");t&&(t.enabled=e)},Game.prototype.getWaveCounts=function(){},Game.prototype.commonChestTimer=function(){setInterval(function(){this.bonusCommonChestTimer+=1e3;var e=this.commonButtonReward.findByName("Common Chest Timer");if(this.bonusCommonChestTimer<3e5){var t=(3e5-this.bonusCommonChestTimer)/1e3,i=parseInt(t/60);t%=60,e.element.text=Math.round(i)+":"+(Math.round(t)<10?"0"+Math.round(t):Math.round(t)),e.element.fontSize=32}this.bonusCommonChestTimer>=3e5&&(this.commonButtonReward.button.active=!0,e.element.text="Watch 1 AD",e.element.fontSize=19)}.bind(this),1e3)},Game.prototype.rareChestTimer=function(){setInterval(function(){this.bonusRareChestTimer+=1e3;var e=this.rareButtonReward.findByName("Rare Chest Timer");if(this.bonusRareChestTimer<3e5){var t=(3e5-this.bonusRareChestTimer)/1e3,i=parseInt(t/60);t%=60,e.element.text=Math.round(i)+":"+(Math.round(t)<10?"0"+Math.round(t):Math.round(t)),e.element.fontSize=32}this.bonusRareChestTimer>=3e5&&(this.rareButtonReward.button.active=!0,this.setRemainingRareAds(),e.element.fontSize=19)}.bind(this),1e3)},Game.prototype.epicChestTimer=function(){setInterval(function(){this.bonusEpicChestTimer+=1e3;var e=this.epicButtonReward.findByName("Epic Chest Timer");if(this.bonusEpicChestTimer<3e5){var t=(3e5-this.bonusEpicChestTimer)/1e3,i=parseInt(t/60);t%=60,e.element.text=Math.round(i)+":"+(Math.round(t)<10?"0"+Math.round(t):Math.round(t)),e.element.fontSize=32}this.bonusEpicChestTimer>=3e5&&!this.epicButtonReward.active&&(this.epicButtonReward.button.active=!0,this.setRemainingEpicAds(),e.element.fontSize=19)}.bind(this),1e3)},Game.prototype.rewardTimer=function(){setInterval(function(){if(this.bonusRewardTimer+=1e3,this.bonusRewardTimer<18e4){var e=(18e4-this.bonusRewardTimer)/1e3,t=parseInt(e/60);e%=60,this.bonusRewardHudTimer.findByName("Ad Timer").element.text=Math.round(t)+":"+(Math.round(e)<10?"0"+Math.round(e):Math.round(e)),this.bonusRewardHudTimer.enabled=!0,this.bonusRewardHudBtn.enabled=!1}this.bonusRewardTimer>=18e4&&!this.bonusRewardHudBtn.enabled&&(this.bonusRewardHudTimer.enabled=!1,this.bonusRewardHudBtn.enabled=!0,this.rewardValue=this.randomReward(7,3),this.bonusRewardTxt.element.text=this.rewardValue)}.bind(this),1e3)},Game.prototype.setSpeedLockedState=function(e){this.firstSpeedLockedGame=e},Game.prototype.firstSpeedLockedHandler=function(){this.resetUnitDeploy(),this.gamePauseState(!0),this.app.timeScale=0,this.speedLockedMechanicTutorial(!0),this.setSpeedLockedState(!1)},Game.prototype.speedRewardTimer=function(){setInterval(function(){var e=this.getSpeedUpState();if(!e&&(this.speedUpBonusRewardTimer+=1e3,this.speedUpBonusRewardTimer<18e4)){var t=18e4-this.speedUpBonusRewardTimer;this.speedBonusRewardHudTimer.enabled=!0,this.speedBonusRewardHudTimer.button.active=!0,this.speedBonusRewardHudBtn.enabled=!1;var i=t/1e3,n=parseInt(i/60);i%=60;var s=this.speedBonusRewardHudTimer.findByName("Speed Ad Timer"),a=Math.round(n)+":"+(Math.round(i)<10?"0"+Math.round(i):Math.round(i));s.element.text=a,this.speedBonusRewardTxt.element.text=a,s.element.color=new pc.Color(1,1,1)}if(this.speedUpBonusRewardTimer>=18e4&&!this.speedBonusRewardHudBtn.enabled&&(this.speedBonusRewardHudTimer.enabled=!1,this.speedBonusRewardHudBtn.enabled=!0),this.speedUpBonusRewardTimer>=18e4&&e&&(this.speedingUpTimer+=1e3,this.speedingUpTimer<3e4)){this.speedBonusRewardHudTimer.enabled=!0,this.speedBonusRewardHudTimer.button.active=!1;var o=(3e4-this.speedingUpTimer)/1e3,r=parseInt(o/60);o%=60;var h=this.speedBonusRewardHudTimer.findByName("Speed Ad Timer"),d=Math.round(r)+":"+(Math.round(o)<10?"0"+Math.round(o):Math.round(o));h.element.text=d,this.speedBonusRewardTxt.element.text=d,h.element.color=new pc.Color(1,.69,.21)}}.bind(this),1e3)},Game.prototype.speedBonusTimer=function(e){this.speedUpBonusRewardTimer=e},Game.prototype.speedingUpTimerReset=function(e){this.speedingUpTimer=e},Game.prototype.speedUpState=function(e){this.speedingUp=e},Game.prototype.getSpeedUpState=function(){return this.speedingUp},Game.prototype.gameOverSpeedReset=function(){this.speedBonusTimer(0),this.speedingUpTimerReset(0),this.speedUpState(!1)},Game.prototype.randomReward=function(e,t){return 100*Math.floor(Math.random()*e+t)},Game.prototype.setFirstSpeedState=function(e){this.firstSpeedUpTutorial=e},Game.prototype.getResources=function(){return this.resources},Game.prototype.rewardResources=function(){var e,t=this.entity.findByName("Spawn").script.spawnLocation.getCurrentWave();if(this.gameEndlessModeState()&&t>3)this.resources+=25;else{switch(t){case 1:e=50,PokiSDK.happyTime(.2);break;case 2:e=75,PokiSDK.happyTime(.4);break;case 3:e=100,PokiSDK.happyTime(.6)}this.resources+=e}},Game.prototype.findCamera=function(){var e=pc.app.root.findByName("Camerat");if(e)return e},Game.hitPosition=new pc.Vec3,Game.dragPosition=new pc.Vec3,Game.prototype.triggerCommercialBreak=function(e=!0,t=!1){this.showingAd||(this.showingAd=!0,e&&PokiSDK.gameplayStop(),this.app.systems.sound.volume=0,PokiSDK.commercialBreak().then((()=>{console.log("Commercial break finished, proceeding to game"),this.showingAd=!1,!e&&!t||this.firstTutorialShowcase||PokiSDK.gameplayStart();try{this.app.systems.sound.volume=1}catch(e){console.error(e)}}),this))},Game.prototype.calculateCommonChestAdReward=function(e,t){this.commonChestCoins=this.randomReward(e,t)},Game.prototype.calculateRareChestAdReward=function(e,t){this.rareChestCoins=this.randomReward(e,t)},Game.prototype.calculateEpicChestAdReward=function(e,t){this.epicChestCoins=this.randomReward(e,t)},Game.prototype.onAdCommonChest=function(){console.log("Inside onCommonChestAd! Showing ad: "+this.showingAd),this.showingAd||(this.showingAd=!0,this.gamePause||PokiSDK.gameplayStop(),this.app.systems.sound.volume=0,PokiSDK.rewardedBreak().then((e=>{if(console.log("Ad showed: "+e),e){var t=this;t.app.timeScale=0,t.calculateCommonChestAdReward(2,2),t.commonRewardCollectWindow.findByName("Reward Collecting").element.text=t.commonChestCoins+" coins",this.chestsInterface.enabled=!1,this.commonButtonReward.button.active=!1,t.commonRewardCollectWindow.enabled=!0}this.gamePause||PokiSDK.gameplayStart();try{this.app.systems.sound.volume=1}catch(e){console.log(e)}this.showingAd=!1}),this))},Game.prototype.commonChestRewardCollect=function(){this.resources+=this.commonChestCoins,this.bonusCommonChestTimer=0;this.getSpeedUpState()?this.app.timeScale=2:this.app.timeScale=1},Game.prototype.onAdRareChest=function(){console.log("Inside onCommonChestAd! Showing ad: "+this.showingAd),this.showingAd||(this.showingAd=!0,this.gamePause||PokiSDK.gameplayStop(),this.app.systems.sound.volume=0,PokiSDK.rewardedBreak().then((e=>{if(console.log("Ad showed: "+e),e){if(1!=this.currentRareAdCounter())this.decrementRareAdCounter();else{var t=this;t.calculateRareChestAdReward(5,5),t.rareRewardCollectWindow.findByName("Reward Collecting").element.text=t.rareChestCoins+" coins",t.app.timeScale=0,t.rareRewardCollectWindow.enabled=!0}this.bonusRareChestTimer=0,this.chestsInterface.enabled=!1,this.rareButtonReward.button.active=!1}this.gamePause||PokiSDK.gameplayStart();try{this.app.systems.sound.volume=1}catch(e){console.log(e)}this.showingAd=!1}),this))},Game.prototype.rareChestRewardCollect=function(){var e=this;this.resources+=this.rareChestCoins,this.setRareAdCounter(2),this.rareChestCannonReward("FREE"),e.rareChestRewardState(!0),this.getSpeedUpState()?e.app.timeScale=2:e.app.timeScale=1},Game.prototype.onAdEpicChest=function(){console.log("Inside onCommonChestAd! Showing ad: "+this.showingAd),this.showingAd||(this.showingAd=!0,this.gamePause||PokiSDK.gameplayStop(),this.app.systems.sound.volume=0,PokiSDK.rewardedBreak().then((e=>{if(console.log("Ad showed: "+e),e){if(1!=this.currentEpicAdCounter())this.decrementEpicAdCounter();else{var t=this;t.calculateEpicChestAdReward(35,15),t.epicRewardCollectWindow.findByName("Reward Collecting").element.text=t.epicChestCoins+" coins",t.app.timeScale=0,t.epicRewardCollectWindow.enabled=!0}this.bonusEpicChestTimer=0,this.chestsInterface.enabled=!1,this.epicButtonReward.button.active=!1}this.gamePause||PokiSDK.gameplayStart();try{this.app.systems.sound.volume=1}catch(e){console.log(e)}this.showingAd=!1}),this))},Game.prototype.epicChestRewardCollect=function(){this.resources+=this.epicChestCoins,this.setEpicAdCounter(3),this.epicChestCannonReward("FREE"),this.epicChestRewardState(!0);this.getSpeedUpState()?this.app.timeScale=2:this.app.timeScale=1},Game.prototype.onAd=function(){console.log("Inside onAd! Showing ad: "+this.showingAd),this.showingAd||(this.showingAd=!0,this.gamePause||PokiSDK.gameplayStop(),this.app.systems.sound.volume=0,PokiSDK.rewardedBreak().then((e=>{console.log("Ad showed: "+e),e&&(this.resources+=this.rewardValue,this.bonusRewardTimer=0,this.watchAdInterface.enabled=!1),this.gamePause||PokiSDK.gameplayStart();try{this.app.systems.sound.volume=1}catch(e){console.log(e)}this.showingAd=!1}),this))},Game.prototype.onAdSpeedUp=function(){console.log("Inside onAdSpeedUp! Showing ad: "+this.showingAd),this.showingAd||(this.showingAd=!0,this.gamePause||PokiSDK.gameplayStop(),this.app.systems.sound.volume=0,PokiSDK.rewardedBreak().then((e=>{console.log("Ad showed: "+e),e&&(this.speedUpWatchAdInterface.enabled=!1,this.speedBonusRewardHudTimer.enabled=!1,this.speedBonusRewardHudBtn.enabled=!0,this.speedBonusRewardHudBtn.script.speedUpbutton.speedUpHandler()),this.gamePause||PokiSDK.gameplayStart();try{this.app.systems.sound.volume=1}catch(e){console.log(e)}this.showingAd=!1}),this))},Game.prototype.setRemainingRareAds=function(){var e=this.rareButtonReward.findByName("Rare Chest Timer"),t=1===this.rareChestAdCounter?"AD":"ADs";e.element.text="Watch "+this.rareChestAdCounter+" "+t},Game.prototype.setRemainingEpicAds=function(){var e=this.epicButtonReward.findByName("Epic Chest Timer"),t=1===this.epicChestAdCounter?"AD":"ADs";e.element.text="Watch "+this.epicChestAdCounter+" "+t},Game.prototype.currentRareAdCounter=function(){return this.rareChestAdCounter},Game.prototype.decrementRareAdCounter=function(){this.rareChestAdCounter-=1},Game.prototype.setRareAdCounter=function(e){this.rareChestAdCounter=e},Game.prototype.currentEpicAdCounter=function(){return this.epicChestAdCounter},Game.prototype.decrementEpicAdCounter=function(){this.epicChestAdCounter-=1},Game.prototype.setEpicAdCounter=function(e){this.epicChestAdCounter=e},Game.prototype.rareChestCannonReward=function(e){var t,i,n=this.app.root.findByName("UI").findByName("GameScreen");switch(this.entity.script.mapsystem.levelNumber()){case 1:t="Unit Selection",i="Yellow Cannon 1";break;case 2:t="Unit Selection 2",i="Black Cannon 1";break;case 3:t="Unit Selection 3",i="Blue Cannon 1";break;case 4:t="Unit Selection 4",i="White Cannon 1";break;case 5:t="Unit Selection 5",i="Red Cannon 1";break;case 6:t="Unit Selection 6",i="Green Cannon 1"}n.findByName(t).findByName(i).findByName("Price").element.text=e},Game.prototype.epicChestCannonReward=function(e){var t,i,n=this.app.root.findByName("UI").findByName("GameScreen");switch(this.entity.script.mapsystem.levelNumber()){case 1:t="Unit Selection",i="Yellow Cannon 2";break;case 2:t="Unit Selection 2",i="Black Cannon 2";break;case 3:t="Unit Selection 3",i="Blue Cannon 2";break;case 4:t="Unit Selection 4",i="White Cannon 2";break;case 5:t="Unit Selection 5",i="Red Cannon 2";break;case 6:t="Unit Selection 6",i="Green Cannon 2"}n.findByName(t).findByName(i).findByName("Price").element.text=e},Game.prototype.rareChestRewardState=function(e){this.freeCannon1Reward=e},Game.prototype.epicChestRewardState=function(e){this.freeCannon2Reward=e},Game.prototype.currentFreeCannon1State=function(){return this.freeCannon1Reward},Game.prototype.currentFreeCannon2State=function(){return this.freeCannon2Reward},Game.prototype.saveGameState=function(e){try{for(var t=[],i=class{constructor(e,t,i,n){this.number=e,this.unlocked=t,this.stars=i,this.finished=n}},n=this.state,s=0;s<6;s++){var a=0,o=0===s||s>0&&s<e+1;e>=0&&(o=o||n.levels[s].unlocked),e>=0&&s<=e-1&&o&&(a=3),console.log("Level being saved: "+(s+1)+", unlockedState: "+o+", stars: "+a),t.push(new i(s+1,o,a,a>0))}console.log("Levels array: "+t.toString()),console.log("Levels saved: "+t.length);var r=new class{constructor(e){this.levels=e}}(t);this.state=r;try{this.storageFactory.setItem(this.entity.name,JSON.stringify(r))}catch(e){console.error(e)}}catch(e){console.log(e)}},Game.prototype.loadGameState=function(){try{console.log("Loading game state!"),this.state=JSON.parse(this.storageFactory.getItem(this.entity.name)),console.log(this.state),null===this.state&&(this.saveGameState(-1),this.state=JSON.parse(this.storageFactory.getItem(this.entity.name)));for(var e=this.state.levels,t=this.app.root.findByName("UI"),i=t.findByName("Levels").findByTag("Level"),n=t.findByTag("StarsOn"),s=0;s<i.length;s++){var a=e[s];i[s].enabled=a.unlocked,n[s].enabled=a.finished,console.log("Current Level at onEnable: "+a.number+", "+a.unlocked)}}catch(e){console.error(e)}},Game.prototype.onDisable=function(){this.watchAdButton.off("click")},Game.prototype.newGame=function(){var e=this.app,t=e.root.findByName("UI");t.findByName("Game Over").enabled=!1;for(var i=t.findByName("Tutorial").children,n=0;n<i.length;n++)i[n].enabled=!1;this.resetUnitDeploy(),this.explodeRobots(),this.destroyCannons(),this.timer=0,this.isGameOver=!1,this.resources=this.initialResources,this.entity.script.mapsystem.reset(),this.getSpeedUpState()&&this.gameOverSpeedReset(),this.firstTutorialShowcase?e.timeScale=0:e.timeScale=1,e.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),e.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),e.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this)},Game.prototype.firstTutorialState=function(e){this.firstTutorialShowcase=e},Game.prototype.explodeRobots=function(){for(var e=this.entity.findByTag("Robot"),t=0;t<e.length;t++){e[t].script.robot.explode()}for(var i=this.entity.findByTag("Destroyed"),n=0;n<i.length;n++){i[n].destroy()}},Game.prototype.destroyCannons=function(){for(var e=this.entity.findByTag("Cannon"),t=0;t<e.length;t++){e[t].destroy()}},Game.prototype.resetUnitDeploy=function(){this.nullDeploy(),this.nullHighlightGround(),this.nullBorderClicked(),this.resetIconState()},Game.prototype.nullDeploy=function(){this.unitToDeploy=null,this.unitToDeployBlueprint&&(this.entity.findByName(this.unitToDeployBlueprint+"").enabled=!1,this.unitToDeployBlueprint=null)},Game.prototype.nullHighlightGround=function(){var e=this.entity.findByName("GreenHighlight"),t=this.entity.findByName("RedHighlight");e.enabled=!1,t.enabled=!1},Game.prototype.nullBorderClicked=function(){var e,t,i=this.app.root.findByName("UI").findByName("GameScreen");switch(this.entity.script.mapsystem.levelNumber()){case 1:e=i.findByName("Unit Selection");break;case 2:e=i.findByName("Unit Selection 2");break;case 3:e=i.findByName("Unit Selection 3");break;case 4:e=i.findByName("Unit Selection 4");break;case 5:e=i.findByName("Unit Selection 5");break;case 6:e=i.findByName("Unit Selection 6")}if(e){t=e.findByTag("Border Clicked");for(var n=0;n<t.length;n++)t[n].enabled=!1}},Game.prototype.resetIconState=function(){var e,t,i=this.app.root.findByName("UI").findByName("GameScreen");switch(this.entity.script.mapsystem.levelNumber()){case 1:e=i.findByName("Unit Selection");break;case 2:e=i.findByName("Unit Selection 2");break;case 3:e=i.findByName("Unit Selection 3");break;case 4:e=i.findByName("Unit Selection 4");break;case 5:e=i.findByName("Unit Selection 5");break;case 6:e=i.findByName("Unit Selection 6")}if(e){t=e.findByTag("Icon");for(var n=0;n<t.length;n++)t[n].script.icons.resetClickedState()}},Game.prototype.destroyedRobot=function(e,t,i,n){var s=this.app.root.findByName("Templates");s.enabled=!0;var a=s.findByName(n).clone();this.entity.addChild(a),a.setPosition(e,t,i),a.enabled=!0,setTimeout(function(){a.destroy()}.bind(this),2500)},Game.prototype.returnDragState=function(){return this.dragState},Game.prototype.gameOver=function(){var e=this.app;e.root.findByName("UI").findByName("Game Over").enabled=!0,this.isGameOver=!0,e.timeScale=0},Game.prototype.noSufficientResources=function(){var e=this.app.root.findByName("UI");e.findByName("Not Enough Resources").enabled=!0,setTimeout(function(){e.findByName("Not Enough Resources").enabled=!1}.bind(this),2e3)},Game.prototype.returnDragEntity=function(){if(this.dragEntity)return this.dragEntity},Game.prototype.resetNewWaves=function(e,t,i,n,s){this.totalEnemiesWave1=e,this.totalEnemiesWave2=t,this.totalEnemiesWave3=i,this.totalEnemiesWave4=s,this.resetNewWaveEnemies(),this.setEnemiesLeft(0),this.setWavesLeft();for(var a=this.entity.findByTag("SpawnLocation"),o=0;o<a.length;o++)a[o].script.spawnLocation.resetWaves(),a[o].script.spawnLocation.changeWaveEnemies(e,t,i),a[o].script.spawnLocation.changeRobot(n),this.gameEndlessModeState()&&a[o].script.spawnLocation.setEndlessWaveCount(s)},Game.prototype.resetBasesHealth=function(){this.resetMaxHealth()},Game.prototype.tutorialUI=function(){var e=this.tutorial.findByName("Highlight 1");this.gamePause?(e.enabled=!0,PokiSDK.gameplayStop()):(this.app.timeScale=1,e.enabled=!1,PokiSDK.gameplayStart())},Game.prototype.mergeTutorial=function(e){this.tutorial.findByName("Highlight 2").enabled=e,e?PokiSDK.gameplayStop():PokiSDK.gameplayStart()},Game.prototype.mobileMergeTutorial=function(e){this.tutorial.findByName("Highlight 4").enabled=e,e?PokiSDK.gameplayStop():PokiSDK.gameplayStart()},Game.prototype.speedMechanicTutorial=function(e){this.tutorial.findByName("Highlight 5").enabled=e,e?PokiSDK.gameplayStop():PokiSDK.gameplayStart()},Game.prototype.speedLockedMechanicTutorial=function(e){this.tutorial.findByName("Highlight 6").enabled=e,e?PokiSDK.gameplayStop():PokiSDK.gameplayStart()},Game.prototype.gamePauseState=function(e){this.gamePause=e},Game.prototype.checkDoubleSpawn=function(){return this.entity.findByTag("SpawnLocation").length>1},Game.prototype.resetNewWaveEnemies=function(){this.currentEnemies=0},Game.prototype.setEnemiesLeft=function(e){var t=this.waveEnemyHandler(),i=this.entity.findByName("Spawn"),n=1;i&&(n=i.script.spawnLocation.getCurrentWave()),this.currentEnemies+=e,this.enemiesLeft.element.text=this.checkDoubleSpawn()&&n>=3?this.currentEnemies+"/"+2*t:this.currentEnemies+"/"+t},Game.prototype.getEndlessRobotHp=function(){return this.endlessRobotHp},Game.prototype.getEndlessRobotSpeed=function(){return this.endlessRobotSpeed},Game.prototype.incrementWaveEndless4=function(){this.totalEnemiesWave4+=10,this.endlessRobotHp+=10,this.endlessRobotSpeed+=.02},Game.prototype.waveEnemyHandler=function(){var e=0,t=this.entity.findByName("Spawn");if(t)switch(t.script.spawnLocation.getCurrentWave()){case 1:e=this.totalEnemiesWave1;break;case 2:e=this.totalEnemiesWave2;break;case 3:e=this.totalEnemiesWave3;break;default:e=this.totalEnemiesWave4}return e},Game.prototype.setWavesLeft=function(){var e=this.entity.findByName("Spawn");e&&(this.wavesLeft.element.text=this.gameEndlessModeState()?e.script.spawnLocation.getCurrentWave()+"/~":e.script.spawnLocation.getCurrentWave()+"/3")},Game.prototype.setHealth=function(e){this.currentHealth=this.currentHealth-e,this.remainingHPHandler(this.currentHealth)},Game.prototype.remainingHPHandler=function(e){var t=this.hpElement/100*e;this.remainingWidthHandler(t)},Game.prototype.remainingWidthHandler=function(e){this.remainingHP.element.width=e,this.remainingHP.element.width<=0&&(this.remainingHP.element.width=0,this.gameOver())},Game.prototype.resetMaxHealth=function(){this.currentHealth=100,this.remainingHPHandler(this.currentHealth)},Game.prototype.playAgainHandler=function(){switch(this.newGame(),this.resetBasesHealth(),this.entity.script.mapsystem.levelNumber()){case 1:this.resetNewWaves(5,15,25,"Robot 1",20);break;case 2:this.resetNewWaves(25,35,45,"Robot 2",45);break;case 3:this.resetNewWaves(25,35,30,"Robot 3",30);break;case 4:this.resetNewWaves(25,35,45,"Robot 4",45);break;case 5:this.resetNewWaves(25,35,40,"Robot 5",40);break;case 6:this.resetNewWaves(25,35,45,"Robot 6",45)}},Game.prototype.onMouseDown=function(e,t=!1){var i=this.app,n=i.root.findByName("UI");if(this.cameraEntity||void 0!==this.cameraEntity.camera){var s=this.cameraEntity.getPosition(),a=this.cameraEntity.camera.screenToWorld(e.x,e.y,this.cameraEntity.camera.farClip);i.systems.rigidbody.raycastFirst(s,a,function(t){if(this.app.touch,e.button===pc.MOUSEBUTTON_LEFT)switch(t.entity.name){case"Placable":if(this.unitToDeploy){var i,s=t.entity.getPosition(),a=Math.round(s.x/2),o=Math.round(s.z/2);switch(this.unitToDeploy){case"Yellow Cannon 1":this.currentFreeCannon1State()?(i=5,this.rareChestRewardState(!1),this.rareChestCannonReward("250")):this.resources>=250?(i=5,this.resources-=250,this.firstMerge&&(this.mergeCount++,2===this.mergeCount&&(this.resetUnitDeploy(),this.gamePauseState(!0),this.app.touch?this.mobileMergeTutorial(!0):this.mergeTutorial(!0),this.firstMerge=!1))):this.noSufficientResources();break;case"Yellow Cannon 2":this.currentFreeCannon2State()?(i=6,this.epicChestRewardState(!1),this.epicChestCannonReward("500")):this.resources>=500?(i=6,this.resources-=500):this.noSufficientResources();break;case"Yellow Cannon 3":this.resources>=750?(i=7,this.resources-=750):this.noSufficientResources();break;case"Black Cannon 1":this.currentFreeCannon1State()?(i=8,this.rareChestRewardState(!1),this.rareChestCannonReward("250")):this.resources>=250?(i=8,this.resources-=250):this.noSufficientResources();break;case"Black Cannon 2":this.currentFreeCannon2State()?(i=9,this.epicChestRewardState(!1),this.epicChestCannonReward("500")):this.resources>=500?(i=9,this.resources-=500):this.noSufficientResources();break;case"Black Cannon 3":this.resources>=750?(i=10,this.resources-=750):this.noSufficientResources();break;case"Blue Cannon 1":this.currentFreeCannon1State()?(i=11,this.rareChestRewardState(!1),this.rareChestCannonReward("250")):this.resources>=250?(i=11,this.resources-=250):this.noSufficientResources();break;case"Blue Cannon 2":this.currentFreeCannon2State()?(i=12,this.epicChestRewardState(!1),this.epicChestCannonReward("500")):this.resources>=500?(i=12,this.resources-=500):this.noSufficientResources();break;case"Blue Cannon 3":this.resources>=750?(i=13,this.resources-=750):this.noSufficientResources();break;case"White Cannon 1":this.currentFreeCannon1State()?(i=14,this.rareChestRewardState(!1),this.rareChestCannonReward("250")):this.resources>=250?(i=14,this.resources-=250):this.noSufficientResources();break;case"White Cannon 2":this.currentFreeCannon2State()?(i=15,this.epicChestRewardState(!1),this.epicChestCannonReward("500")):this.resources>=500?(i=15,this.resources-=500):this.noSufficientResources();break;case"White Cannon 3":this.resources>=750?(i=16,this.resources-=750):this.noSufficientResources();break;case"Red Cannon 1":this.currentFreeCannon1State()?(i=17,this.rareChestRewardState(!1),this.rareChestCannonReward("250")):this.resources>=250?(i=17,this.resources-=250):this.noSufficientResources();break;case"Red Cannon 2":this.currentFreeCannon2State()?(i=18,this.epicChestRewardState(!1),this.epicChestCannonReward("500")):this.resources>=500?(i=18,this.resources-=500):this.noSufficientResources();break;case"Red Cannon 3":this.resources>=750?(i=19,this.resources-=750):this.noSufficientResources();break;case"Green Cannon 1":this.currentFreeCannon1State()?(i=20,this.rareChestRewardState(!1),this.rareChestCannonReward("250")):this.resources>=250?(i=20,this.resources-=250):this.noSufficientResources();break;case"Green Cannon 2":this.currentFreeCannon2State()?(i=21,this.epicChestRewardState(!1),this.epicChestCannonReward("500")):this.resources>=500?(i=21,this.resources-=500):this.noSufficientResources();break;case"Green Cannon 3":this.resources>=750?(i=22,this.resources-=750):this.noSufficientResources()}i&&(this.entity.script.mapsystem.setSpaceType(a,o,i),PokiSDK.happyTime(.2)),this.unitToDeployBlueprint&&(this.entity.findByName(this.unitToDeployBlueprint+"").enabled=!1)}this.removeRangeMesh(),this.afterMergeHandler(),this.sellButtonInitialize(!1);break;case"Yellow Cannon 1":case"Yellow Cannon 2":case"Yellow Cannon 3":case"Black Cannon 1":case"Black Cannon 2":case"Black Cannon 3":case"Blue Cannon 1":case"Blue Cannon 2":case"Blue Cannon 3":case"White Cannon 1":case"White Cannon 2":case"White Cannon 3":case"Red Cannon 1":case"Red Cannon 2":case"Red Cannon 3":case"Green Cannon 1":case"Green Cannon 2":case"Green Cannon 3":this.app.touch?!1===this.mobileDragState?(this.unitToSellPosition=t.entity.getPosition(),this.sellButtonInitialize(!0),this.removeRangeMesh(),t.entity.script.cannon.rangeMesh.enabled=!0,this.firstMouseDragEntity=t.entity,this.initialCannonPositionHandler(t),this.touchMoveMobile(),this.mobileDragState=!0):!0===this.mobileDragState&&t.entity!==this.firstMouseDragEntity&&(this.mouseDragEntity=t.entity,this.mouseUpHandler()):(this.unitToSellPosition=t.entity.getPosition(),this.sellButtonInitialize(!0),this.removeRangeMesh(),t.entity.script.cannon.rangeMesh.enabled=!0,!1===this.dragState&&(!1===this.initialPositionSaved&&(this.dragEntity=t.entity,this.plane=new pc.Plane(this.dragEntity.getPosition().clone(),this.dragEntity.up.clone()),this.initialCannonPositionHandler(t),this.initialPositionSaved=!0),this.dragState=!0));break;case"Environment Objects":(this.app.touch||!1===this.sellButtonHover)&&(this.removeRangeMesh(),this.afterMergeHandler(),this.sellButtonInitialize(!1))}else e.button===pc.MOUSEBUTTON_RIGHT&&(this.unitToDeploy&&(n.findByName(this.unitToDeploy+"").findByName("Border Clicked").enabled=!1,this.unitToDeploy=null,this.iconClickedState(!1)),this.unitToDeployBlueprint&&(this.entity.findByName(this.unitToDeployBlueprint+"").enabled=!1,this.unitToDeployBlueprint=null))}.bind(this))}},Game.prototype.iconClickedState=function(e){this.iconClicked=e},Game.prototype.initialCannonPositionHandler=function(e){var t=e.entity.getPosition();this.initialPosition=new pc.Vec3(t.x,t.y,t.z),this.initialPositionX=Math.round(this.initialPosition.x/2),this.initialPositionY=Math.round(this.initialPosition.z/2)},Game.prototype.removeRangeMesh=function(){var e=this.entity.findByTag("RangeMesh");if(e.length>0)for(var t=0;t<e.length;t++)e[t].enabled=!1},Game.prototype.sellButtonInitialize=function(e){this.sellButton.enabled=e},Game.prototype.sellButtonHoverState=function(e){this.sellButtonHover=e},Game.prototype.getTouch=function(e){return this.lastTouch=new pc.Vec2(e.touches[0].x,e.touches[0].y),this.lastTouch},Game.prototype.doRayCastDrag=function(e){this.cameraEntity.camera.screenToWorld(e.x,e.y,this.cameraEntity.camera.farClip,this.ray.direction),this.ray.origin.copy(this.cameraEntity.getPosition()),this.ray.direction.sub(this.ray.origin).normalize();var t=Raycast.hitPosition,i=Raycast.dragPosition;this.plane.intersectsRay(this.ray,t)&&(i.sub2(t,this.dragEntity.getPosition()),i.add(this.dragEntity.getPosition()),this.dragEntity.setPosition(i))},Game.prototype.unitHighlighting=function(){if(this.entity.findByName("Main Light").enabled=!1,this.entity.findByName("Drag Light").enabled=!0,!1===this.getSpotlightChildren){for(var e=this.entity.children,t=0;t<e.length;t++){var i=e[t];this.app.touch?i.name==this.firstMouseDragEntity.name&&(i.findByName("Aim").script.switchingMaterials.changeToNextMaterial(1),i.findByName("Body").script.switchingMaterials.changeToNextMaterial(1)):i.name==this.dragEntity.name&&(i.findByName("Aim").script.switchingMaterials.changeToNextMaterial(1),i.findByName("Body").script.switchingMaterials.changeToNextMaterial(1))}this.getSpotlightChildren=!0}},Game.prototype.mobileGreenHighlights=function(e){var t=this.entity.findByTag("Placable");if(!0===e)for(var i=0;i<t.length;i++){var n=t[i].getPosition(),s=this.entity.findByName("GreenHighlight").clone();s.enabled=!0,s.rigidbody?s.rigidbody.teleport(n):s.setPosition(n),s.tags.add("Highlight Clone"),this.entity.addChild(s)}else if(!1===e)for(var a=this.entity.findByTag("Highlight Clone"),o=0;o<a.length;o++)a[o].destroy()},Game.prototype.touchMoveMobile=function(){this.unitHighlighting(),this.resetUnitDeploy()},Game.prototype.onMouseMove=function(e){if(!0===this.dragState&&(this.resetUnitDeploy(),this.doRayCastDrag(e),this.unitHighlighting()),this.unitToDeploy){var t=this.app,i=this.cameraEntity.getPosition(),n=this.cameraEntity.camera.screenToWorld(e.x,e.y,this.cameraEntity.camera.farClip);t.systems.rigidbody.raycastFirst(i,n,function(e){var t=e.entity.getPosition(),i=Math.round(t.x/2),n=Math.round(t.z/2),s=this.entity.script.mapsystem.getSpaceType(i,n),a=this.entity.findByName("GreenHighlight"),o=this.entity.findByName("RedHighlight");3==s?(o&&o.enabled&&(o.enabled=!1),a.enabled=!0,a.setPosition(2*i,.01,2*n),this.entity.findByName(this.unitToDeployBlueprint).enabled=!0,this.entity.findByName(this.unitToDeployBlueprint).setPosition(2*i,.01,2*n),this.entity.findByName(this.unitToDeployBlueprint).findByName("Range Mesh").enabled=!0):(a&&a.enabled&&(a.enabled=!1,this.entity.findByName(this.unitToDeployBlueprint+"").enabled=!1),o.enabled=!0,o.setPosition(2*i,.01,2*n))}.bind(this))}},Game.prototype.onMouseUp=function(e){this.mouseUpHandler()},Game.prototype.mouseUpHandler=function(){if(!this.app.touch||void 0!==this.mouseDragEntity&&null!==this.mouseDragEntity){if(!0===this.dragState||!0===this.mobileDragState){var e=this.app.touch?this.mouseDragEntity.getPosition():this.dragEntity.getPosition();this.mergeHandler(e)}this.afterMergeHandler()}},Game.prototype.mergeHandler=function(e){var t=Math.round(e.x/2),i=Math.round(e.z/2),n=this.initialPosition,s=this.initialPositionX,a=this.initialPositionY,o=this.entity.script.mapsystem.getSpaceName(t,i),r=this.entity.script.mapsystem.getSpaceName(s,a);switch(o){case"Yellow Cannon 1":t==s&&i==a||r!=o?this.dragEntityReposition(n):(this.entity.script.mapsystem.changeMergeState(),this.dragEntityDestroy(),this.entity.script.mapsystem.setSpaceType(t,i,6),this.entity.script.mapsystem.setSpaceType(s,a,3),PokiSDK.happyTime(.5),this.sellButtonInitialize(!1),this.firstYellow2&&(this.app.root.findByName("UI").findByName("Yellow Cannon 2 Locked").enabled=!1,this.app.root.findByName("UI").findByName("Yellow Cannon 2").enabled=!0,this.firstYellow2=!1,this.app.touch?this.mobileMergeTutorial(!1):this.mergeTutorial(!1),this.gamePauseState(!1)));break;case"Yellow Cannon 2":t==s&&i==a||r!=o?this.dragEntityReposition(n):(this.entity.script.mapsystem.changeMergeState(),this.dragEntityDestroy(),this.entity.script.mapsystem.setSpaceType(t,i,7),this.entity.script.mapsystem.setSpaceType(s,a,3),PokiSDK.happyTime(1),this.sellButtonInitialize(!1),this.firstYellow3&&(this.app.root.findByName("UI").findByName("Yellow Cannon 3 Locked").enabled=!1,this.app.root.findByName("UI").findByName("Yellow Cannon 3").enabled=!0,this.firstYellow3=!1));break;case"Black Cannon 1":t==s&&i==a||r!=o?this.dragEntityReposition(n):(this.entity.script.mapsystem.changeMergeState(),this.dragEntityDestroy(),this.entity.script.mapsystem.setSpaceType(t,i,9),this.entity.script.mapsystem.setSpaceType(s,a,3),PokiSDK.happyTime(.5),this.sellButtonInitialize(!1),this.firstBlack2&&(this.app.root.findByName("UI").findByName("Black Cannon 2 Locked").enabled=!1,this.app.root.findByName("UI").findByName("Black Cannon 2").enabled=!0,this.firstBlack2=!1));break;case"Black Cannon 2":t==s&&i==a||r!=o?this.dragEntityReposition(n):(this.entity.script.mapsystem.changeMergeState(),this.dragEntityDestroy(),this.entity.script.mapsystem.setSpaceType(t,i,10),this.entity.script.mapsystem.setSpaceType(s,a,3),PokiSDK.happyTime(1),this.sellButtonInitialize(!1),this.firstBlack3&&(this.app.root.findByName("UI").findByName("Black Cannon 3 Locked").enabled=!1,this.app.root.findByName("UI").findByName("Black Cannon 3").enabled=!0,this.firstBlack3=!1));break;case"Blue Cannon 1":t==s&&i==a||r!=o?this.dragEntityReposition(n):(this.entity.script.mapsystem.changeMergeState(),this.dragEntityDestroy(),this.entity.script.mapsystem.setSpaceType(t,i,12),this.entity.script.mapsystem.setSpaceType(s,a,3),PokiSDK.happyTime(.5),this.sellButtonInitialize(!1),this.firstBlue2&&(this.app.root.findByName("UI").findByName("Blue Cannon 2 Locked").enabled=!1,this.app.root.findByName("UI").findByName("Blue Cannon 2").enabled=!0,this.firstBlue2=!1));break;case"Blue Cannon 2":t==s&&i==a||r!=o?this.dragEntityReposition(n):(this.entity.script.mapsystem.changeMergeState(),this.dragEntityDestroy(),this.entity.script.mapsystem.setSpaceType(t,i,13),this.entity.script.mapsystem.setSpaceType(s,a,3),PokiSDK.happyTime(1),this.sellButtonInitialize(!1),this.firstBlue3&&(this.app.root.findByName("UI").findByName("Blue Cannon 3 Locked").enabled=!1,this.app.root.findByName("UI").findByName("Blue Cannon 3").enabled=!0,this.firstBlue3=!1));break;case"White Cannon 1":t==s&&i==a||r!=o?this.dragEntityReposition(n):(this.entity.script.mapsystem.changeMergeState(),this.dragEntityDestroy(),this.entity.script.mapsystem.setSpaceType(t,i,15),this.entity.script.mapsystem.setSpaceType(s,a,3),PokiSDK.happyTime(.5),this.sellButtonInitialize(!1),this.firstWhite2&&(this.app.root.findByName("UI").findByName("White Cannon 2 Locked").enabled=!1,this.app.root.findByName("UI").findByName("White Cannon 2").enabled=!0,this.firstWhite2=!1));break;case"White Cannon 2":t==s&&i==a||r!=o?this.dragEntityReposition(n):(this.entity.script.mapsystem.changeMergeState(),this.dragEntityDestroy(),this.entity.script.mapsystem.setSpaceType(t,i,16),this.entity.script.mapsystem.setSpaceType(s,a,3),PokiSDK.happyTime(1),this.sellButtonInitialize(!1),this.firstWhite3&&(this.app.root.findByName("UI").findByName("White Cannon 3 Locked").enabled=!1,this.app.root.findByName("UI").findByName("White Cannon 3").enabled=!0,this.firstWhite3=!1));break;case"Red Cannon 1":t==s&&i==a||r!=o?this.dragEntityReposition(n):(this.entity.script.mapsystem.changeMergeState(),this.dragEntityDestroy(),this.entity.script.mapsystem.setSpaceType(t,i,18),this.entity.script.mapsystem.setSpaceType(s,a,3),PokiSDK.happyTime(.5),this.sellButtonInitialize(!1),this.firstRed2&&(this.app.root.findByName("UI").findByName("Red Cannon 2 Locked").enabled=!1,this.app.root.findByName("UI").findByName("Red Cannon 2").enabled=!0,this.firstRed2=!1));break;case"Red Cannon 2":t==s&&i==a||r!=o?this.dragEntityReposition(n):(this.entity.script.mapsystem.changeMergeState(),this.dragEntityDestroy(),this.entity.script.mapsystem.setSpaceType(t,i,19),this.entity.script.mapsystem.setSpaceType(s,a,3),PokiSDK.happyTime(1),this.sellButtonInitialize(!1),this.firstRed3&&(this.app.root.findByName("UI").findByName("Red Cannon 3 Locked").enabled=!1,this.app.root.findByName("UI").findByName("Red Cannon 3").enabled=!0,this.firstRed3=!1));break;case"Green Cannon 1":t==s&&i==a||r!=o?this.dragEntityReposition(n):(this.entity.script.mapsystem.changeMergeState(),this.dragEntityDestroy(),this.entity.script.mapsystem.setSpaceType(t,i,21),this.entity.script.mapsystem.setSpaceType(s,a,3),PokiSDK.happyTime(.5),this.sellButtonInitialize(!1),this.firstGreen2&&(this.app.root.findByName("UI").findByName("Green Cannon 2 Locked").enabled=!1,this.app.root.findByName("UI").findByName("Green Cannon 2").enabled=!0,this.firstGreen2=!1));break;case"Green Cannon 2":t==s&&i==a||r!=o?this.dragEntityReposition(n):(this.entity.script.mapsystem.changeMergeState(),this.dragEntityDestroy(),this.entity.script.mapsystem.setSpaceType(t,i,22),this.entity.script.mapsystem.setSpaceType(s,a,3),PokiSDK.happyTime(1),this.sellButtonInitialize(!1),this.firstGreen3&&(this.app.root.findByName("UI").findByName("Green Cannon 3 Locked").enabled=!1,this.app.root.findByName("UI").findByName("Green Cannon 3").enabled=!0,this.firstGreen3=!1));break;default:this.dragEntityReposition(n)}},Game.prototype.mainLight=function(){!1===this.entity.findByName("Main Light").enabled&&(this.entity.findByName("Main Light").enabled=!0,this.entity.findByName("Drag Light").enabled=!1)},Game.prototype.unitDefaultHighlight=function(){if(!0===this.getSpotlightChildren){for(var e=this.entity.getChildren(),t=0;t<e.length;t++){var i=e[t];this.app.touch?i.name==this.firstMouseDragEntity.name&&(i.findByName("Aim").script.switchingMaterials.changeToNextMaterial(0),i.findByName("Body").script.switchingMaterials.changeToNextMaterial(0)):i.name==this.dragEntity.name&&(i.findByName("Aim").script.switchingMaterials.changeToNextMaterial(0),i.findByName("Body").script.switchingMaterials.changeToNextMaterial(0))}this.getSpotlightChildren=!1}},Game.prototype.afterMergeHandler=function(){this.mainLight(),this.unitDefaultHighlight(),this.dragState=!1,this.initialPositionSaved=!1,this.entity.findByName("GreenHighlight").enabled=!1,this.entity.findByName("RedHighlight").enabled=!1,this.firstMouseDragEntity=null,this.mouseDragEntity=null,this.mobileDragState=!1},Game.prototype.dragEntityDestroy=function(){this.app.touch?this.mouseDragEntity.destroy():this.dragEntity.destroy()},Game.prototype.dragEntityReposition=function(e){this.app.touch||this.dragEntity.setPosition(e)};var Robot=pc.createScript("robot");Robot.attributes.add("speed",{type:"number",default:.5}),Robot.attributes.add("damage",{type:"number",default:5}),Robot.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this);var t=this.app;this.scale=1;var e=t.root.findByName("Game");this.destinationIndex=0;var i=e.findByTag("Destination");i[1]&&(this.destinationIndex=this.randomPath());var a=i[this.destinationIndex],s=this.entity.getPosition(),n=a.getPosition();this.path=e.script.mapsystem.getPath(Math.round(s.x/2),Math.round(s.z/2),Math.round(n.x/2),Math.round(n.z/2)),this.timer=0;var o=pc.math.random(0,.4);this.speed=this.speed+o;var r=e.script.game.getEndlessRobotHp(),h=e.script.game.getEndlessRobotSpeed(),p=this.entity.parent.findByName("Spawn").script.spawnLocation.getCurrentWave(),d=this.entity.script.health.maxHealth;switch(p){case 1:this.entity.script.health.changeMaxHealth(.7*d),this.speed+=.2,this.damage-=10;break;case 2:break;case 3:this.entity.script.health.changeMaxHealth(1.3*d),this.speed-=.4,this.damage+=10;break;default:this.entity.script.health.changeMaxHealth(1.3*d+r),this.speed+=h,this.damage+=10}this.firstDestroying=!0},Robot.prototype.hit=function(){},Robot.prototype.checkDoubleSpawnRobot=function(){return this.entity.parent.findByTag("SpawnLocation").length>1},Robot.prototype.explode=function(){var t=this.app.root.findByName("Game"),e=this.entity.getPosition(),i=this.entity.name+" Destroyed";t.script.game.destroyedRobot(e.x,e.y,e.z,i),this.entity.enabled=!1,this.firstDestroying&&(this.signalDestroyIncrement(),this.firstDestroying=!1),setTimeout(function(){this.entity.destroy()}.bind(this),100)},Robot.prototype.signalDestroyIncrement=function(){this.app.root.findByName("Game").script.game.setEnemiesLeft(1)},Robot.prototype.update=function(t){if(!this.entity.parent.parent.script.game.showingAd&&!this.entity.parent.parent.script.game.gamePause&&this.path){var e=this.app.root.findByName("Game");this.timer+=t*this.speed;var i=this.timer/this.path.get(0).length;if(i>1){var a=e.findByTag("Destination");a&&(this.signalDestroyIncrement(),this.entity.destroy(),a[this.destinationIndex].script.baseHealth.reduce(this.damage)),this.path=null}else{var s=this.entity.getPosition(),n=this.path.value(i),o=new pc.Vec3(2*n[0],0,2*n[1]);if(o.x-s.x!=0||o.z-s.z!=0){var r=Math.atan2(o.x-s.x,o.z-s.z)/Math.PI*180;this.entity.setEulerAngles(0,r,0)}this.entity.setPosition(o)}}},Robot.prototype.randomPath=function(){return Math.floor(2*Math.random())},Robot.prototype.onTriggerEnter=function(t){try{var e=this.entity.findByName("Head"),i=this.entity.findByName("Body");e.script.switchingMaterials.changeToNextMaterial(1),i.script.switchingMaterials.changeToNextMaterial(1),setTimeout(function(){e.script.switchingMaterials.changeToNextMaterial(0),i.script.switchingMaterials.changeToNextMaterial(0)}.bind(this),50),t.destroy()}catch(t){console.log(t)}};var Button=pc.createScript("button");Button.attributes.add("currentLevel",{type:"number",title:"Current Level"}),Button.attributes.add("unitSelectionType",{type:"string",default:"",title:"Unit selection type:"}),Button.attributes.add("endlessMode",{type:"boolean",default:!1}),Button.prototype.initialize=function(){this.ui=this.app.root.findByName("UI"),this.levelScreen=this.ui.findByName("Levels"),this.levelMap=this.ui.findByName(this.levelMiniMap),this.unitSelection=this.ui.findByName(this.unitSelectionType),this.entity.button.on("click",this.onPlay,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.endlessActiveState()},Button.prototype.onKeyDown=function(e){this.entity.enabled&&(e.key!==pc.KEY_SPACE&&e.key!==pc.KEY_ENTER||this.buttonEvent(),e.event.preventDefault())},Button.prototype.onPlay=function(){this.buttonEvent()},Button.prototype.endlessActiveState=function(){this.buttonEndlessModeState()&&(this.entity.parent.findByName("StarsOn").enabled&&(this.entity.button.active=!0))},Button.prototype.levelButtonsActiveState=function(e){for(var t=this.app.root.findByName("UI").findByName("Levels").findByTag("Level"),n=0;n<t.length;n++)t[n].button.active=e},Button.prototype.buttonEndlessModeState=function(){return this.endlessMode},Button.prototype.buttonEvent=function(){var e=this.app;this.ui.findByName("Endless Not Unlocked Tutorial").enabled=!1;var t=e.root.findByName("Game");if(!t.script.game.showingAd){this.entity.sound.play("PlayButton"),t.script.game.triggerCommercialBreak(!1,!0);var n=this.ui.findByName("GameScreen"),a=this.app.root.findByName("Maps"),i=(t.findByName("Spawn"),t.findByName("Camerat"));this.entity.parent.enabled=!1,this.levelScreen.enabled=!1,n.enabled=!0,this.unitSelection.enabled=!0,t.script.mapsystem.changeLevelNumber(this.currentLevel),t.script.game.newGame(),t.script.game.resetMaxHealth(),this.levelButtonsActiveState(!0);var s=this.app.root.findByName("Background Music");switch(1!==this.currentLevel&&(this.ui.findByName("SpeedButton").button.active=!0),t.script.game.setGameEndlessModeState(this.buttonEndlessModeState()),this.currentLevel){case 1:t.script.game.resetNewWaves(5,15,25,"Robot 1",20),t.findByName("Destination Base 1").enabled=!0,a.findByName("1").enabled=!0,i.setLocalPosition(new pc.Vec3(16.491,21.1,39.934)),i.setLocalEulerAngles(new pc.Vec3(-52.79,-18.8,0)),s.sound.play("Forest Theme");break;case 2:t.script.game.resetNewWaves(25,35,45,"Robot 2",45),t.findByName("Destination Base 2").enabled=!0,a.findByName("2").enabled=!0,i.setPosition(19.214,25.662,42.715),i.setLocalEulerAngles(-53.99,-11.8,0),s.sound.play("Forest Theme");break;case 3:t.script.game.resetNewWaves(25,35,30,"Robot 3",30),t.findByName("Destination Base 3").enabled=!0,a.findByName("3").enabled=!0,i.setPosition(31.534,23.534,40.307),i.setLocalEulerAngles(-53.39,-14.6,0),s.sound.play("Forest Theme");break;case 4:t.script.game.resetNewWaves(25,35,45,"Robot 4",45),t.findByName("Destination Base 4").enabled=!0,a.findByName("4").enabled=!0,i.setPosition(17.749,24.748,45.093),i.setLocalEulerAngles(-45.39,-18.8,0),s.sound.play("Desert Theme");break;case 5:t.script.game.resetNewWaves(25,35,40,"Robot 5",40),t.findByName("Destination Base 5").enabled=!0,a.findByName("5").enabled=!0,i.setPosition(21.81,28.739,45.81),i.setLocalEulerAngles(-49.59,-17.8,0),s.sound.play("Desert Theme");break;case 6:t.script.game.resetNewWaves(25,35,45,"Robot 6",45),t.findByName("Destination Base 6").enabled=!0,a.findByName("6").enabled=!0,i.setPosition(21.348,29.707,43.593),i.setLocalEulerAngles(-52.39,-20.4,0),s.sound.play("Desert Theme")}1===this.currentLevel&&t.script.game.firstTutorialShowcase||this.timeScaleState(1),t.script.game.gamePauseState(!1)}},Button.prototype.timeScaleState=function(e){this.app.timeScale=e};var Health=pc.createScript("health");Health.attributes.add("maxHealth",{type:"number",default:100}),Health.attributes.add("barHeight",{type:"number",default:3}),Health.attributes.add("remainingMaterial",{type:"asset",assetType:"material"}),Health.attributes.add("emptyMaterial",{type:"asset",assetType:"material"}),Health.attributes.add("gameEntity",{type:"entity"}),Health.prototype.initialize=function(){this.app;var t=this.entity.findByName("Health Bar");t&&t.destroy(),this.healthBar=new pc.Entity,this.healthBar.name="Health Bar",this.remaining=new pc.Entity,this.remainingBox=new pc.Entity,this.empty=new pc.Entity,this.emptyBox=new pc.Entity,this.entity.addChild(this.healthBar),this.healthBar.addChild(this.remaining),this.remaining.addChild(this.remainingBox),this.healthBar.addChild(this.empty),this.empty.addChild(this.emptyBox),this.healthBar.setLocalPosition(0,this.barHeight,0),this.remaining.setLocalPosition(-1,0,0),this.remainingBox.setLocalPosition(.5,0,0),this.empty.setLocalPosition(1,0,0),this.emptyBox.setLocalPosition(-.5,0,0),this.remainingBox.addComponent("model",{type:"box",castShadows:!1}),this.emptyBox.addComponent("model",{type:"box",castShadows:!1});var e=this.remainingMaterial.resource;this.remainingBox.model.meshInstances[0].material=e;var a=this.emptyMaterial.resource;this.emptyBox.model.meshInstances[0].material=a,this.setHealth(this.maxHealth),this.firstTimeZeroHealth=!0},Health.prototype.setHealth=function(t){this.currentHealth=t,this.currentHealth<=0?(this.currentHealth=0,this.entity.script.robot.explode(),this.firstTimeZeroHealth&&(this.gameEntity.script.game.rewardResources(),this.firstTimeZeroHealth=!1)):this.entity.script.robot.hit(),this.remaining.setLocalScale(2*this.currentHealth/this.maxHealth,.15,.15),this.empty.setLocalScale(2*(this.maxHealth-this.currentHealth)/this.maxHealth,.15,.15)},Health.prototype.reduce=function(t){this.setHealth(this.currentHealth-t)},Health.prototype.changeMaxHealth=function(t){this.maxHealth=t},Health.prototype.update=function(t){this.healthBar.setEulerAngles(0,0,0)};var Tweenmanager=pc.createScript("tweenmanager");Tweenmanager.prototype.initialize=function(){},Tweenmanager.prototype.update=function(e){TWEEN.update()};var Icons=pc.createScript("icons");this.clicked=!1,Icons.attributes.add("price",{type:"number",default:0,title:"Resources needed"}),Icons.attributes.add("icon1",{type:"string",default:"",title:"Cannon 1:"}),Icons.attributes.add("icon2",{type:"string",default:"",title:"Cannon 2:"}),Icons.attributes.add("icon3",{type:"string",default:"",title:"Cannon 3:"}),Icons.prototype.initialize=function(){var e=this.app,n=e.root.findByName("Game"),i=e.root.findByName("UI");this.firstIconTutorial=!0;var a=i.findByName(this.icon1),d=i.findByName(this.icon2),r=i.findByName(this.icon3);this.entity.button.on("click",(function(){var e=this.getResourcesAvailable(),i=n.script.game.currentFreeCannon1State(),o=n.script.game.currentFreeCannon2State();if(this.clicked)this.clicked&&(n.script.game.unitToDeploy=null,a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!1,this.clicked=!1,n.script.game.iconClickedState(!1));else{if(e<this.price&&!i&&!o)return void n.script.game.noSufficientResources();switch(n.script.game.unitToDeploy=this.entity.name,this.entity.name){case"Yellow Cannon 1":a.findByName("Border Clicked").enabled=!0,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!1,n.script.game.unitToDeployBlueprint="Yellow Cannon 1 Hover",this.firstIconTutorial&&(n.script.game.gamePauseState(!1),n.script.game.tutorialUI(),this.firstIconTutorial=!1,n.script.game.firstTutorialState(!1));break;case"Yellow Cannon 2":a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!0,r.findByName("Border Clicked").enabled=!1,n.script.game.unitToDeployBlueprint="Yellow Cannon 2 Hover";break;case"Yellow Cannon 3":a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!0,n.script.game.unitToDeployBlueprint="Yellow Cannon 3 Hover";break;case"Black Cannon 1":a.findByName("Border Clicked").enabled=!0,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!1,n.script.game.unitToDeployBlueprint="Black Cannon 1 Hover";break;case"Black Cannon 2":a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!0,r.findByName("Border Clicked").enabled=!1,n.script.game.unitToDeployBlueprint="Black Cannon 2 Hover";break;case"Black Cannon 3":a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!0,n.script.game.unitToDeployBlueprint="Black Cannon 3 Hover";break;case"Blue Cannon 1":a.findByName("Border Clicked").enabled=!0,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!1,n.script.game.unitToDeployBlueprint="Blue Cannon 1 Hover";break;case"Blue Cannon 2":a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!0,r.findByName("Border Clicked").enabled=!1,n.script.game.unitToDeployBlueprint="Blue Cannon 2 Hover";break;case"Blue Cannon 3":a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!0,n.script.game.unitToDeployBlueprint="Blue Cannon 3 Hover";break;case"White Cannon 1":a.findByName("Border Clicked").enabled=!0,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!1,n.script.game.unitToDeployBlueprint="White Cannon 1 Hover";break;case"White Cannon 2":a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!0,r.findByName("Border Clicked").enabled=!1,n.script.game.unitToDeployBlueprint="White Cannon 2 Hover";break;case"White Cannon 3":a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!0,n.script.game.unitToDeployBlueprint="White Cannon 3 Hover";break;case"Red Cannon 1":a.findByName("Border Clicked").enabled=!0,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!1,n.script.game.unitToDeployBlueprint="Red Cannon 1 Hover";break;case"Red Cannon 2":a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!0,r.findByName("Border Clicked").enabled=!1,n.script.game.unitToDeployBlueprint="Red Cannon 2 Hover";break;case"Red Cannon 3":a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!0,n.script.game.unitToDeployBlueprint="Red Cannon 3 Hover";break;case"Green Cannon 1":a.findByName("Border Clicked").enabled=!0,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!1,n.script.game.unitToDeployBlueprint="Green Cannon 1 Hover";break;case"Green Cannon 2":a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!0,r.findByName("Border Clicked").enabled=!1,n.script.game.unitToDeployBlueprint="Green Cannon 2 Hover";break;case"Green Cannon 3":a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!0,n.script.game.unitToDeployBlueprint="Green Cannon 3 Hover"}this.clicked=!0,n.script.game.iconClickedState(!0)}}),this)},Icons.prototype.resetClickedState=function(){var e=this.app.root.findByName("Game");this.clicked=!1,e.script.game.iconClickedState(!1)},Icons.prototype.getResourcesAvailable=function(){return this.app.root.findByName("Game").script.game.getResources()},Icons.prototype.clearBlueprintMode=function(){var e=this.app,n=e.root.findByName("UI"),i=e.root.findByName("Game"),a=n.findByName(this.icon1),d=n.findByName(this.icon2),r=n.findByName(this.icon3);i.script.game.nullDeploy(),a.findByName("Border Clicked").enabled=!1,d.findByName("Border Clicked").enabled=!1,r.findByName("Border Clicked").enabled=!1,i.script.game.iconClickedState(!1),this.clicked=!1},Icons.prototype.pulseByResources=function(){var e=this.getResourcesAvailable(),n=this.app.root.findByName("Game").script.game.currentFreeCannon1State(),i=this.app.root.findByName("Game").script.game.currentFreeCannon2State();e<this.price&&!n&&!i?(this.entity.script.colorPulse.pulse=!1,this.clicked&&this.clearBlueprintMode()):this.entity.script.colorPulse.pulse=!0},Icons.prototype.update=function(e){this.pulseByResources()};var Building=pc.createScript("building");Building.prototype.initialize=function(){},Building.prototype.explode=function(){this.destructionTime=1},Building.prototype.update=function(i){if(this.destructionTime>0&&(this.destructionTime-=i,this.destructionTime<0)){var t=this.app.root.findByName("Game"),e=this.entity.getPosition(),n=Math.round(e.x/10),o=Math.round(e.z/10);t.script.mapsystem.setSpaceType(n,o,0)}};var Cannon=pc.createScript("cannon");Cannon.attributes.add("fireInterval",{type:"number",default:.5}),Cannon.attributes.add("range",{type:"number",default:10}),Cannon.attributes.add("detectRange",{type:"number",default:15}),Cannon.attributes.add("damage",{type:"number",default:5}),Cannon.attributes.add("power",{type:"number",default:1}),Cannon.attributes.add("bullet",{type:"entity"}),Cannon.attributes.add("robotTarget",{type:"string",default:"Robot 1",title:"Robot target"}),Cannon.attributes.add("rangeMesh",{type:"entity"});var tempVec=new pc.Vec3,tempQuat=new pc.Quat;Cannon.prototype.initialize=function(){this.timeToFire=0,this.game=this.app.root.findByName("Game")},Cannon.prototype.update=function(t){if(!this.entity.parent.script.game.showingAd&&!this.entity.parent.script.game.gamePause){var e,i=this.game,a=0,n=this.entity.getPosition(),r=this.entity.parent.script.game.returnDragState(),o=this.entity.parent.script.game.returnDragEntity();if(!r||this.entity!==o)if(this.target){if(this.target){if(!this.target.parent)return void(this.target=null);e=this.target.getPosition();var s=this.entity.findByName("Aim"),p=s.findByName("Shoot");tempQuat.copy(s.getRotation()),s.lookAt(e.x,e.y+2,e.z);var h=s.getRotation();tempQuat.slerp(tempQuat,h,.4),s.setRotation(tempQuat),tempVec.sub2(n,e),a=tempVec.length(),this.timeToFire-=t,this.timeToFire<=0&&(a<=this.range?(tempVec.sub2(n,e),p.particlesystem.isPlaying()||(p.particlesystem.reset(),p.particlesystem.play()),this.target&&(this.entity.sound.play("Shoot"),this.shoot()),this.target.script.health.reduce(this.damage),this.timeToFire=this.fireInterval):this.target=null)}}else for(var d=i.findByTag("Robot"),u=0;u<d.length;u++){var g=d[u];if(e=g.getPosition(),tempVec.sub2(n,e),(a=tempVec.length())<=this.detectRange){this.target=g;break}}}},Cannon.prototype.shoot=function(t){var e=this.bullet.clone();this.entity.addChild(e);var i=this.entity.findByName("Aim");this.force=new pc.Vec3,this.force.copy(i.forward),this.force.scale(this.power);var a=i.getPosition(),n=i.forward;a.add(n.scale(.01*i.rigidbody.linearVelocity.length())),e.setPosition(a);var r=i.getRotation();e.setRotation(r),e.enabled=!0,e.rigidbody.applyImpulse(this.force),setTimeout(function(){e.destroy()}.bind(this),400)};var ChangingScenes=pc.createScript("changingScenes");ChangingScenes.attributes.add("sceneName",{type:"string",default:"",title:"Scene Name to Load"}),ChangingScenes.prototype.initialize=function(e){},ChangingScenes.prototype.update=function(e){},ChangingScenes.prototype.changeScene=function(){this.app.root.findByName("Root").destroy(),this.loadScene(this.sceneName,(function(){}))},ChangingScenes.prototype.loadScene=function(e,n){var t=this.app.scenes.find(e);this.app.scenes.loadSceneHierarchy(t.url,(function(e,t){e?console.error(e):n(t)}))};var RobotAnimation=pc.createScript("robotAnimation");RobotAnimation.attributes.add("animateInterval",{type:"number",default:1}),RobotAnimation.prototype.initialize=function(){this.timeToAnimate=0},RobotAnimation.prototype.update=function(t){var i=this.app.root.findByName("Game"),o=this.entity.getPosition();if(this.entity.setPosition(o.x,.3,o.z),this.timeToAnimate-=t,this.timeToAnimate<=0){this.entity.setPosition(o.x,.45,o.z);var e=pc.math.clamp(250-i.script.game.timer,0,250)/250;this.timeToAnimate=this.animateInterval*e}};var types=[{name:"Road",walkable:!0},{name:"Destination",walkable:!0},{name:"Spawn",walkable:!0},{name:"Placable",walkable:!1},{name:"Environment Objects",walkable:!1},{name:"Yellow Cannon 1",walkable:!0},{name:"Yellow Cannon 2",walkable:!0},{name:"Yellow Cannon 3",walkable:!0},{name:"Black Cannon 1",walkable:!0},{name:"Black Cannon 2",walkable:!0},{name:"Black Cannon 3",walkable:!0},{name:"Blue Cannon 1",walkable:!0},{name:"Blue Cannon 2",walkable:!0},{name:"Blue Cannon 3",walkable:!0},{name:"White Cannon 1",walkable:!0},{name:"White Cannon 2",walkable:!0},{name:"White Cannon 3",walkable:!0},{name:"Red Cannon 1",walkable:!0},{name:"Red Cannon 2",walkable:!0},{name:"Red Cannon 3",walkable:!0},{name:"Green Cannon 1",walkable:!0},{name:"Green Cannon 2",walkable:!0},{name:"Green Cannon 3",walkable:!0}],level1=[[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[2,0,0,0,0,0,0,0,0,0,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,3,0,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,3,0,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,3,0,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]],level2=[[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4],[4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,4,4,4,4,4,4],[4,4,4,4,4,4,0,3,3,3,3,3,3,3,3,3,3,0,3,3,4,4,4,4,4,4,4],[4,4,4,4,4,4,0,3,3,3,3,3,3,3,3,3,3,0,3,3,4,4,4,4,4,4,4],[4,4,4,4,4,4,0,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4],[4,4,4,4,4,4,0,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4],[4,4,4,4,4,4,0,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4],[2,0,0,0,0,0,0,4,4,4,4,4,4,4,4,3,3,0,0,0,0,0,0,0,0,1,0],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]],level3=[[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,0,3,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,0,3,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,0,3,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,0,3,3,3,4,4,4,4,4,4,4],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]],level4=[[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[4,4,4,4,4,4,4,4,4,3,3,3,0,3,3,3,3,3,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,3,3,3,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]],level5=[[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[4,4,4,4,4,4,4,4,4,3,3,3,0,3,3,3,3,3,3,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,3,3,0,3,3,3,3,3,3,4,4,4,4,4,4,4,4],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]],level6=[[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4],[2,0,0,0,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,1],[4,4,4,4,4,4,4,3,3,0,3,3,3,3,3,0,3,3,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,3,3,0,3,3,3,3,3,0,3,3,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,3,3,0,0,0,0,0,0,0,3,3,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,3,3,3,3,3,0,3,3,3,3,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,3,3,3,3,3,0,3,3,3,3,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,3,3,3,3,3,0,3,3,3,3,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,3,3,3,3,3,0,3,3,3,3,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,3,3,0,0,0,0,0,0,0,3,3,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,3,3,0,3,3,3,3,3,0,3,3,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,3,3,0,3,3,3,3,3,0,3,3,4,4,4,4,4,4,4,4,4],[2,0,0,0,0,0,0,0,0,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,1],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]],MapSystem=pc.createScript("mapsystem");MapSystem.prototype.initialize=function(){this.getMatrix(level1),this.merging=!1,this.levelReset=!1},MapSystem.prototype.changeLevelNumber=function(e){this.currentLevel=e},MapSystem.prototype.getMatrix=function(e){this.map=[];for(var t=0;t<e.length;t++){this.map.push([]);for(var a=0;a<e[0].length;a++)this.map[t][a]={type:-1,entity:null}}},MapSystem.prototype.getSpaceType=function(e,t){return this.map[t][e].type},MapSystem.prototype.getSpaceName=function(e,t){var a=this.getSpaceType(e,t);return types[a].name},MapSystem.prototype.setSpaceType=function(e,t,a){var n=this.app,i=this.map[t][e].type,l=!1;if(a!==i||2==a||3==a){i>3&&3===a&&(l=!0),this.map[t][e].entity&&(this.map[t][e].entity.destroy(),this.map[t][e].entity=null);var s=n.root.findByName("Templates"),r=s.findByName(types[a].name),o=null;if(r&&((o=r.clone()).enabled=!0,o.rigidbody?(o.rigidbody.teleport(2*e,0,2*t),a>4&&(this.placementAnimation(o),this.merging&&(this.mergeParticle(o),this.merging=!1))):(o.setPosition(2*e,0,2*t),a>4&&(this.placementAnimation(o),this.merging&&(this.mergeParticle(o),this.merging=!1))),this.entity.addChild(o),3===a&&!l||3===a&&this.levelReset)){var p=s.findByName("GridGreenHighlight"),m=null;p&&((m=p.clone()).enabled=!0,m.rigidbody?m.rigidbody.teleport(2*e,.01,2*t):m.setPosition(2*e,.01,2*t)),this.entity.findByName("Level Grid").addChild(m)}this.map[t][e]={type:a,entity:o}}},MapSystem.prototype.placementAnimation=function(e){e.sound.play("Placement"),e.setLocalScale(1.5,1.5,1.5),setTimeout(function(){e.setLocalScale(1,1,1)}.bind(this),100),setTimeout(function(){e.setLocalScale(.6,.6,.6)}.bind(this),200),setTimeout(function(){e.setLocalScale(1.2,1.2,1.2)}.bind(this),300),setTimeout(function(){e.setLocalScale(.9,.9,.9)}.bind(this),400)},MapSystem.prototype.mergeParticle=function(e){e.findByName("Merge").enabled=!0},MapSystem.prototype.changeMergeState=function(){this.merging=!0},MapSystem.prototype.isWalkable=function(e,t){var a=this.map[t][e].type;return types[a].walkable},MapSystem.prototype.reset=function(){switch(this.levelResetState(!0),this.currentLevel){case 1:if(this.resetMatrix(level1),console.log(this.entity.script.game.firstMerge),this.entity.script.game.firstMerge){PokiSDK.gameplayStart();this.app.timeScale=0,this.entity.script.game.gamePauseState(!0),this.entity.script.game.tutorialUI()}break;case 2:this.entity.script.game.gamePauseState(!1),this.resetMatrix(level2);break;case 3:this.entity.script.game.gamePauseState(!1),this.resetMatrix(level3);break;case 4:this.entity.script.game.gamePauseState(!1),this.resetMatrix(level4);break;case 5:this.entity.script.game.gamePauseState(!1),this.resetMatrix(level5);break;case 6:this.entity.script.game.gamePauseState(!1),this.resetMatrix(level6)}this.levelResetState(!1)},MapSystem.prototype.levelResetState=function(e){this.levelReset=e},MapSystem.prototype.resetMatrix=function(e){var t=this.app.root.findByName("Templates");t.enabled=!0;var a=new pc.Entity("Level Grid");this.entity.addChild(a);var n,i,l=e[0].length,s=e.length;for(i=0;i<s;i++)for(n=0;n<l;n++)this.setSpaceType(n,i,e[i][n]);t.enabled=!1,this.updatePathFinder()},MapSystem.prototype.updatePathFinder=function(){var e,t,a=this.map[0].length,n=this.map.length,i=[];for(this.walkable=[],t=0;t<n;t++)for(i[t]=[],e=0;e<a;e++)this.isWalkable(e,t)?(this.walkable.push([e,t]),i[t][e]=0):i[t][e]=1;this.pathFinderGrid=new PF.Grid(a,n,i),this.pathFinder=new PF.AStarFinder},MapSystem.prototype.getPath=function(e,t,a,n){if(void 0===a&&void 0===n){var i=this.walkable.length;do{var l=this.walkable[Math.floor(Math.random()*(i-1))];a=l[0],n=l[1]}while(e===a&&t===n)}for(var s=this.pathFinderGrid.clone(),r=this.pathFinder.findPath(e,t,a,n,s),o=[],p=[],m=0;m<r.length;m++){var h=m/(r.length-1);o.push(h,r[m][0]),p.push(h,r[m][1])}var y=new pc.CurveSet(o,p);return y.type=pc.CURVE_LINEAR,y},MapSystem.prototype.levelNumber=function(){return this.currentLevel},MapSystem.prototype.update=function(e){};var SwitchingMaterials=pc.createScript("switchingMaterials");SwitchingMaterials.attributes.add("materials",{type:"asset",assetType:"material",array:!0,title:"Materials"}),SwitchingMaterials.prototype.initialize=function(){},SwitchingMaterials.prototype.changeToNextMaterial=function(t){for(var a=this.materials[t],i=this.entity.model.meshInstances,e=0;e<i.length;++e){i[e].material=a.resource}};var BaseHealth=pc.createScript("baseHealth");BaseHealth.attributes.add("maxHealth",{type:"number",default:100}),BaseHealth.attributes.add("gameEntity",{type:"entity"}),BaseHealth.prototype.initialize=function(){},BaseHealth.prototype.reduce=function(t){var e=0;e=this.checkDoubleDestination()?t/2:t,this.gameEntity.script.game.setHealth(e)},BaseHealth.prototype.checkDoubleDestination=function(){return this.gameEntity.findByTag("Destination").length>1},BaseHealth.prototype.update=function(t){};var NextButton=pc.createScript("nextButton");NextButton.prototype.initialize=function(){this.entity.button.on("click",this.onPlay,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},NextButton.prototype.update=function(t){},NextButton.prototype.onPlay=function(){var t=this.app,e=t.root.findByName("Game");if(!e.script.game.showingAd){t.root.findByName("UI").findByName("Next Button");this.entity.sound.play("ButtonPress");e.script.game.gameEndlessModeState();for(var n=e.findByTag("SpawnLocation"),o=0;o<n.length;o++)n[o].script.spawnLocation.nextPhase();e.script.game.resetNewWaveEnemies(),e.script.game.setWavesLeft(),e.script.game.setEnemiesLeft(0)}},NextButton.prototype.onKeyDown=function(t){this.entity.enabled&&(t.key!==pc.KEY_SPACE&&t.key!==pc.KEY_ENTER||this.onPlay(),t.event.preventDefault())};var ColorPulse=pc.createScript("colorPulse");ColorPulse.prototype.initialize=function(){this.timer=0,this.originalColor=new pc.Color,this.newColor=new pc.Color,this.pulse=!0,this.originalColor.copy(this.entity.element.color)},ColorPulse.prototype.enablePulse=function(o){this.pulse=o},ColorPulse.prototype.update=function(o){if(this.pulse){var i=(new Date).getTime()/100;this.newColor.r=this.originalColor.r-.125*Math.sin(i)-.125,this.newColor.g=this.originalColor.g-.125*Math.sin(i)-.125,this.newColor.b=this.originalColor.b-.125*Math.sin(i)-.125,this.entity.element.color=this.newColor}else this.entity.element.color=this.originalColor};var Raycast=pc.createScript("raycast");Raycast.prototype.initialize=function(){this.ray=new pc.Ray,this.cameraEntity=pc.app.root.findByName("Camerat"),this.dragEntity=this.entity,this.dragState=!1,this.initialPositionSaved=!1,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.plane=new pc.Plane(this.dragEntity.getPosition().clone(),this.dragEntity.up.clone()),this.gameEntity=this.app.root.findByName("Game"),this.initialPosition=new pc.Vec3,this.initialPositionX=null,this.initialPositionY=null,this.initialPositionType=null},Raycast.hitPosition=new pc.Vec3,Raycast.dragPosition=new pc.Vec3,Raycast.prototype.doRayCastDrag=function(t){this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip,this.ray.direction),this.ray.origin.copy(this.cameraEntity.getPosition()),this.ray.direction.sub(this.ray.origin).normalize();var i=Raycast.hitPosition,a=Raycast.dragPosition;this.plane.intersectsRay(this.ray,i)&&(a.sub2(i,this.dragEntity.getPosition()),a.add(this.dragEntity.getPosition()),this.dragEntity.setPosition(a))},Raycast.prototype.onMouseDown=function(t){if(!1===this.dragState){var i=this.cameraEntity.getPosition(),a=this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip);this.app.systems.rigidbody.raycastFirst(i,a,function(i){if(t.button==pc.MOUSEBUTTON_LEFT&&("Bullet Cannon"==i.entity.name||"Bullet Cannon Level 2"==i.entity.name||"Tank Cannon"==i.entity.name)){if(!1===this.dragState&&!1===this.initialPositionSaved){var a=i.entity.getPosition();this.initialPosition=new pc.Vec3(a.x,a.y,a.z),this.initialPositionX=Math.round(this.initialPosition.x/2),this.initialPositionY=Math.round(this.initialPosition.z/2),this.initialPositionSaved=!0}this.dragState=!0}}.bind(this))}},Raycast.prototype.onMouseMove=function(t){if(!0===this.dragState){var i=this.cameraEntity.getPosition(),a=this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip);this.app.systems.rigidbody.raycastFirst(i,a,function(i){this.dragEntity=i.entity,this.doRayCastDrag(t)}.bind(this))}},Raycast.prototype.onMouseUp=function(t){if(!0===this.dragState){var i=this.cameraEntity.getPosition(),a=this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip);this.app.systems.rigidbody.raycastFirst(i,a,function(t){var i=t.entity.getPosition(),a=Math.round(i.x/2),s=Math.round(i.z/2),n=this.initialPosition,o=(this.initialPositionX,this.initialPositionY,this.gameEntity.script.mapsystem.getSpaceName(a,s));switch(console.log("localEntity on mouse up: "+o),o){case"Obstacles":t.entity.setPosition(n);break;case"Bullet Cannon":6,t.entity.destroy(),this.gameEntity.script.mapsystem.setSpaceType(a,s,6)}}.bind(this))}this.dragState=!1,this.initialPositionSaved=!1};var StorageFactory=pc.createScript("storageFactory");StorageFactory.prototype.initialize=function(){void 0===this.inMemoryStorage&&(this.inMemoryStorage={})},StorageFactory.prototype.isSupported=function(){try{var t="__some_random_key_you_are_not_going_to_use__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(t){return!1}},StorageFactory.prototype.clear=function(){this.isSupported()?localStorage.clear():this.inMemoryStorage={}},StorageFactory.prototype.getItem=function(t){return this.isSupported()?localStorage.getItem(t):void 0!==this.inMemoryStorage&&this.inMemoryStorage.hasOwnProperty(t)?this.inMemoryStorage[t]:null},StorageFactory.prototype.key=function key(t){return this.isSupported()?localStorage.key(t):Object.keys(this.inMemoryStorage)[t]||null},StorageFactory.prototype.removeItem=function(t){this.isSupported()?localStorage.removeItem(t):delete this.inMemoryStorage[t]},StorageFactory.prototype.setItem=function(t,e){this.isSupported()?localStorage.setItem(t,e):(void 0===this.inMemoryStorage&&(this.inMemoryStorage={}),this.inMemoryStorage[t]=String(e))},StorageFactory.prototype.getLength=function(){return this.isSupported()?localStorage.length:void 0===this.inMemoryStorage?-1:Object.keys(this.inMemoryStorage).length};var AdButton=pc.createScript("adButton");AdButton.prototype.initialize=function(){this.entity.button.on("click",this.onPlay,this)},AdButton.prototype.update=function(t){},AdButton.prototype.onPlay=function(){this.app.root.findByName("UI").findByName("GameScreen").findByName("WatchAd").enabled=!0};var SellButton=pc.createScript("sellButton");SellButton.attributes.add("gameEntity",{type:"entity"}),SellButton.prototype.initialize=function(){this.entity.button.on("click",this.onPlay,this),this.entity.element.on("mouseenter",this.onEnter,this),this.entity.element.on("mouseleave",this.onOut,this)},SellButton.prototype.update=function(t){},SellButton.prototype.onEnter=function(){this.gameEntity.script.game.sellButtonHoverState(!0)},SellButton.prototype.onOut=function(){this.gameEntity.script.game.sellButtonHoverState(!1)},SellButton.prototype.onPlay=function(){this.sellCannon(),this.app.touch&&this.gameEntity.script.game.afterMergeHandler()},SellButton.prototype.sellCannon=function(){var t=this.gameEntity.script.game.unitToSellPosition,e=Math.round(t.x/2),n=Math.round(t.z/2);switch(this.gameEntity.script.mapsystem.getSpaceName(e,n)){case"Yellow Cannon 1":case"Black Cannon 1":case"Blue Cannon 1":case"White Cannon 1":case"Red Cannon 1":case"Green Cannon 1":this.gameEntity.script.game.resources+=200;break;case"Yellow Cannon 2":case"Black Cannon 2":case"Blue Cannon 2":case"White Cannon 2":case"Red Cannon 2":case"Green Cannon 2":this.gameEntity.script.game.resources+=400;break;case"Yellow Cannon 3":case"Black Cannon 3":case"Blue Cannon 3":case"White Cannon 3":case"Red Cannon 3":case"Green Cannon 3":this.gameEntity.script.game.resources+=600}this.gameEntity.script.mapsystem.setSpaceType(e,n,3),this.entity.enabled=!1};var LevelButton=pc.createScript("levelButton");LevelButton.attributes.add("levelMiniMap",{type:"string",default:"",title:"Level minimap:"}),LevelButton.prototype.initialize=function(){this.ui=this.app.root.findByName("UI"),this.levelMap=this.ui.findByName(this.levelMiniMap),this.entity.button.on("click",this.onPlay,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},LevelButton.prototype.update=function(t){},LevelButton.prototype.onKeyDown=function(t){this.entity.enabled&&(t.key===pc.KEY_1&&this.buttonEvent(),t.event.preventDefault())},LevelButton.prototype.onPlay=function(){this.buttonEvent()},LevelButton.prototype.buttonEvent=function(){this.app.root.findByName("Game");this.levelButtonsActiveState(!1),this.entity.sound.play("LevelButton"),this.levelMap.enabled=!0},LevelButton.prototype.levelButtonsActiveState=function(t){for(var e=this.ui.findByName("Levels").findByTag("Level"),n=0;n<e.length;n++)e[n].button.active=t};var MenuButton=pc.createScript("menuButton");MenuButton.prototype.initialize=function(){this.entity.button.on("click",this.onPlay,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},MenuButton.prototype.onKeyDown=function(t){this.entity.enabled&&(t.key!==pc.KEY_SPACE&&t.key!==pc.KEY_ENTER||this.buttonEvent(),t.event.preventDefault())},MenuButton.prototype.onPlay=function(){this.buttonEvent()},MenuButton.prototype.buttonEvent=function(){var t=this.app;if(!t.root.findByName("Game").script.game.showingAd){var n=t.root.findByName("UI"),e=n.findByName("Levels");n.findByName("Menu Button").sound.play("PlayButton"),n.findByName("IntroScreen").enabled=!1,e.enabled=!0}},MenuButton.prototype.update=function(t){};var LevelButton2=pc.createScript("levelButton2");LevelButton2.attributes.add("levelMiniMap",{type:"string",default:"",title:"Level minimap:"}),LevelButton2.prototype.initialize=function(){this.ui=this.app.root.findByName("UI"),this.levelMap=this.ui.findByName(this.levelMiniMap),this.entity.button.on("click",this.onPlay,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},LevelButton2.prototype.update=function(t){},LevelButton2.prototype.onKeyDown=function(t){this.entity.enabled&&(t.key===pc.KEY_2&&this.buttonEvent(),t.event.preventDefault())},LevelButton2.prototype.onPlay=function(){this.buttonEvent()},LevelButton2.prototype.buttonEvent=function(){this.app.root.findByName("Game");this.levelButtonsActiveState(!1),this.entity.sound.play("LevelButton"),this.levelMap.enabled=!0},LevelButton2.prototype.levelButtonsActiveState=function(t){for(var e=this.ui.findByName("Levels").findByTag("Level"),n=0;n<e.length;n++)e[n].button.active=t};var LevelButton3=pc.createScript("levelButton3");LevelButton3.attributes.add("levelMiniMap",{type:"string",default:"",title:"Level minimap:"}),LevelButton3.prototype.initialize=function(){this.ui=this.app.root.findByName("UI"),this.levelMap=this.ui.findByName(this.levelMiniMap),this.entity.button.on("click",this.onPlay,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},LevelButton3.prototype.update=function(t){},LevelButton3.prototype.onKeyDown=function(t){this.entity.enabled&&(t.key===pc.KEY_3&&this.buttonEvent(),t.event.preventDefault())},LevelButton3.prototype.onPlay=function(){this.buttonEvent()},LevelButton3.prototype.buttonEvent=function(){this.app.root.findByName("Game");this.levelButtonsActiveState(!1),this.entity.sound.play("LevelButton"),this.levelMap.enabled=!0},LevelButton3.prototype.levelButtonsActiveState=function(t){for(var e=this.ui.findByName("Levels").findByTag("Level"),n=0;n<e.length;n++)e[n].button.active=t};var LevelButton4=pc.createScript("levelButton4");LevelButton4.attributes.add("levelMiniMap",{type:"string",default:"",title:"Level minimap:"}),LevelButton4.prototype.initialize=function(){this.ui=this.app.root.findByName("UI"),this.levelMap=this.ui.findByName(this.levelMiniMap),this.entity.button.on("click",this.onPlay,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},LevelButton4.prototype.update=function(t){},LevelButton4.prototype.onKeyDown=function(t){this.entity.enabled&&(t.key===pc.KEY_4&&this.buttonEvent(),t.event.preventDefault())},LevelButton4.prototype.onPlay=function(){this.buttonEvent()},LevelButton4.prototype.buttonEvent=function(){this.app.root.findByName("Game");this.levelButtonsActiveState(!1),this.entity.sound.play("LevelButton"),this.levelMap.enabled=!0},LevelButton4.prototype.levelButtonsActiveState=function(t){for(var e=this.ui.findByName("Levels").findByTag("Level"),n=0;n<e.length;n++)e[n].button.active=t};var LevelButton5=pc.createScript("levelButton5");LevelButton5.attributes.add("levelMiniMap",{type:"string",default:"",title:"Level minimap:"}),LevelButton5.prototype.initialize=function(){this.ui=this.app.root.findByName("UI"),this.levelMap=this.ui.findByName(this.levelMiniMap),this.entity.button.on("click",this.onPlay,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},LevelButton5.prototype.update=function(t){},LevelButton5.prototype.onKeyDown=function(t){this.entity.enabled&&(t.key===pc.KEY_5&&this.buttonEvent(),t.event.preventDefault())},LevelButton5.prototype.onPlay=function(){this.buttonEvent()},LevelButton5.prototype.buttonEvent=function(){this.app.root.findByName("Game");this.levelButtonsActiveState(!1),this.entity.sound.play("LevelButton"),this.levelMap.enabled=!0},LevelButton5.prototype.levelButtonsActiveState=function(t){for(var e=this.ui.findByName("Levels").findByTag("Level"),n=0;n<e.length;n++)e[n].button.active=t};var LevelButton6=pc.createScript("levelButton6");LevelButton6.attributes.add("levelMiniMap",{type:"string",default:"",title:"Level minimap:"}),LevelButton6.prototype.initialize=function(){this.ui=this.app.root.findByName("UI"),this.levelMap=this.ui.findByName(this.levelMiniMap),this.entity.button.on("click",this.onPlay,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},LevelButton6.prototype.update=function(t){},LevelButton6.prototype.onKeyDown=function(t){this.entity.enabled&&(t.key===pc.KEY_6&&this.buttonEvent(),t.event.preventDefault())},LevelButton6.prototype.onPlay=function(){this.buttonEvent()},LevelButton6.prototype.buttonEvent=function(){this.app.root.findByName("Game");this.levelButtonsActiveState(!1),this.entity.sound.play("LevelButton"),this.levelMap.enabled=!0},LevelButton6.prototype.levelButtonsActiveState=function(t){for(var e=this.ui.findByName("Levels").findByTag("Level"),n=0;n<e.length;n++)e[n].button.active=t};var ExitButton=pc.createScript("exitButton");ExitButton.prototype.initialize=function(){this.ui=this.app.root.findByName("UI"),this.entity.button.on("click",this.onPlay,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},ExitButton.prototype.update=function(t){},ExitButton.prototype.onKeyDown=function(t){this.entity.enabled&&(t.key===pc.KEY_ESCAPE&&this.buttonEvent(),t.event.preventDefault())},ExitButton.prototype.onPlay=function(){this.buttonEvent()},ExitButton.prototype.buttonEvent=function(){this.levelButtonsActiveState(!0),this.entity.sound.play("ExitButton"),this.entity.parent.enabled=!1;var t=this.app,e=t.root.findByName("Game"),n=e.script.game.getSpeedUpState();e.script.game.gamePauseState(!1),t.timeScale=n?2:1},ExitButton.prototype.levelButtonsActiveState=function(t){for(var e=this.ui.findByName("Levels").findByTag("Level"),n=0;n<e.length;n++)e[n].button.active=t};var BackButton=pc.createScript("backButton");BackButton.attributes.add("quitMenu",{type:"entity"}),BackButton.prototype.initialize=function(){this.entity.button.on("click",this.onPlay,this)},BackButton.prototype.update=function(t){},BackButton.prototype.onPlay=function(){this.app.timeScale=0,this.app.root.findByName("Game").script.game.gamePauseState(!0),this.quitMenu.enabled=!0};var QuitButton=pc.createScript("quitButton");QuitButton.attributes.add("gameEntity",{type:"entity"}),QuitButton.attributes.add("roadMap",{type:"entity"}),QuitButton.attributes.add("gameScreen",{type:"entity"}),QuitButton.prototype.initialize=function(){this.entity.button.on("click",this.onPlay,this)},QuitButton.prototype.update=function(t){},QuitButton.prototype.onPlay=function(){PokiSDK.gameplayStop(),this.gameEntity.script.game.gamePauseState(!0),this.roadMap.enabled=!0,this.gameScreen.enabled=!1;for(var t=this.app.root.findByName("Maps").children,e=this.gameEntity.findByTag("Destination Base"),i=this.gameScreen.findByTag("Unit Selection"),a=this.gameScreen.findByName("Tutorial").children,n=0;n<6;n++)t[n].enabled=!1,e[n].enabled=!1,i[n].enabled=!1,a[n]&&(a[n].enabled=!1);var o=this.app,r=o.root.findByName("Game");o.root.findByName("Background Music").sound.stop(),r.script.game.clearLevelGridHighlight(),r.script.game.setGameEndlessModeState(!1),this.entity.parent.enabled=!1};var SpeedUpbutton=pc.createScript("speedUpbutton");SpeedUpbutton.attributes.add("gameEntity",{type:"entity"}),SpeedUpbutton.prototype.initialize=function(){this.entity.button.on("click",this.onPlay,this),this.firstSpeedUp=!0},SpeedUpbutton.prototype.update=function(t){},SpeedUpbutton.prototype.onPlay=function(){this.speedUpHandler()},SpeedUpbutton.prototype.speedUpHandler=function(){var t=this.app.root.findByName("Game");this.app.timeScale=2,this.entity.button.active=!1,t.script.game.speedUpState(!0),this.firstSpeedUp&&(this.gameEntity.script.game.speedMechanicTutorial(!1),this.firstSpeedUp=!1),setTimeout(function(){this.app.timeScale=1,this.entity.button.active=!0,this.entity.enabled=!1,t.script.game.speedBonusTimer(0),t.script.game.speedingUpTimerReset(0),t.script.game.speedUpState(!1)}.bind(this),3e4)};var SpeedLockedButton=pc.createScript("speedLockedButton");SpeedLockedButton.prototype.initialize=function(){this.entity.button.on("click",this.onPlay,this),this.firstSpeedLockedButton=!0},SpeedLockedButton.prototype.update=function(e){},SpeedLockedButton.prototype.onPlay=function(){var e=this.app,t=e.root.findByName("UI").findByName("GameScreen"),o=e.root.findByName("Game");if(this.firstSpeedLockedButton){this.app.root.findByName("Game").script.game.speedLockedMechanicTutorial(!1);var a=o.findByName("Spawn");o.script.game.gamePause&&3===a.script.spawnLocation.getCurrentWave()&&(o.script.game.gamePauseState(!1),e.timeScale=1),this.firstSpeedLockedButton=!1,e.root.findByName("Game").script.game.setSpeedLockedState(!1)}t.findByName("Time Machine").enabled=!0};var PlayAgain=pc.createScript("playAgain");PlayAgain.attributes.add("gameEntity",{type:"entity"}),PlayAgain.prototype.initialize=function(){this.entity.button.on("click",this.onPlay,this)},PlayAgain.prototype.onPlay=function(){this.gameEntity.script.game.playAgainHandler()},PlayAgain.prototype.update=function(t){};var StarAnimation=pc.createScript("starAnimation");StarAnimation.prototype.initialize=function(){},StarAnimation.prototype.starAnimating=function(){switch(this.entity.name){case"Star 1":this.entity.enabled=!0,this.entity.setLocalScale(1.5,1.5,1.5),setTimeout(function(){this.entity.setLocalScale(1,1,1)}.bind(this),100),setTimeout(function(){this.entity.setLocalScale(.6,.6,.6)}.bind(this),200),setTimeout(function(){this.entity.setLocalScale(1.2,1.2,1.2)}.bind(this),300),setTimeout(function(){this.entity.setLocalScale(1,1,1)}.bind(this),400);break;case"Star 2":setTimeout(function(){this.entity.enabled=!0,this.entity.setLocalScale(1.5,1.5,1.5)}.bind(this),500),setTimeout(function(){this.entity.setLocalScale(1,1,1)}.bind(this),600),setTimeout(function(){this.entity.setLocalScale(.6,.6,.6)}.bind(this),700),setTimeout(function(){this.entity.setLocalScale(1.2,1.2,1.2)}.bind(this),800),setTimeout(function(){this.entity.setLocalScale(1,1,1)}.bind(this),900);break;case"Star 3":setTimeout(function(){this.entity.enabled=!0,this.entity.setLocalScale(1.5,1.5,1.5)}.bind(this),1e3),setTimeout(function(){this.entity.setLocalScale(1,1,1)}.bind(this),1100),setTimeout(function(){this.entity.setLocalScale(.6,.6,.6)}.bind(this),1200),setTimeout(function(){this.entity.setLocalScale(1.2,1.2,1.2)}.bind(this),1300),setTimeout(function(){this.entity.setLocalScale(1,1,1)}.bind(this),1400)}},StarAnimation.prototype.update=function(t){};var Zoom=pc.createScript("zoom");Zoom.prototype.initialize=function(){this.minFov=25,this.maxFov=45,this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),this.lastTouchPoint=new pc.Vec2,this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)),this.time=0,this.duration=1},Zoom.prototype.update=function(t){var o=this.entity.camera.fov;o>this.maxFov&&(o=this.maxFov),o<this.minFov&&(o=this.minFov),this.entity.camera.fov=o},Zoom.prototype.onMouseWheel=function(t){var o=this.entity.camera.fov+t.deltaWheel;this.entity.camera.fov=o};var ChestButton=pc.createScript("chestButton");ChestButton.attributes.add("chests",{type:"entity"}),ChestButton.prototype.initialize=function(){this.entity.button.on("click",this.onPlay,this)},ChestButton.prototype.update=function(t){},ChestButton.prototype.onPlay=function(){this.chests.enabled=!0};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)})),this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,n=MouseInput.worldDiff,s=this.entity.camera,i=this.entity.camera.nearClip;s.screenToWorld(t.x,t.y,i,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,i,e),n.sub2(e,o),this.entity.setLocalPosition(n)},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown||this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.entity.camera.fov-=t.wheel,t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)})))},TouchInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,n=t.y-i.y;return Math.sqrt(o*o+n*n)},TouchInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInput.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?this.lastTouchPoint.set(i[0].x,i[0].y):2==i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint))},TouchInput.fromWorldPoint=new pc.Vec3,TouchInput.toWorldPoint=new pc.Vec3,TouchInput.worldDiff=new pc.Vec3,TouchInput.prototype.pan=function(t){var i=TouchInput.fromWorldPoint,o=TouchInput.toWorldPoint,n=TouchInput.worldDiff,h=this.entity.camera,c=this.orbitCamera.distance;h.screenToWorld(t.x,t.y,c,i),h.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,c,o),n.sub2(o,i),this.orbitCamera.pivotPoint.add(n)},TouchInput.pinchMidPoint=new pc.Vec2,TouchInput.prototype.onTouchMove=function(t){var i=TouchInput.pinchMidPoint,o=t.touches;if(1==o.length){var n=o[0];this.orbitCamera.pitch-=(n.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(n.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(n.x,n.y)}else if(2==o.length){var h=this.getPinchDistance(o[0],o[1]),c=h-this.lastPinchDistance;this.lastPinchDistance=h,this.orbitCamera.distance-=c*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.pan(i),this.lastPinchMidPoint.copy(i)}};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,onWindowResize=function(){t._checkAspectRatio()};window.addEventListener("resize",onWindowResize,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);this.entity.getRotation();this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch;var i=new pc.Vec3;i.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(i.length()),this._targetDistance=this._distance,this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("destroy",(function(){window.removeEventListener("resize",onWindowResize,!1)}))},OrbitCamera.prototype.update=function(t){this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var n=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,n),Math.atan2(n.y,-n.z)*pc.math.RAD_TO_DEG};var Collect=pc.createScript("collect");Collect.attributes.add("buttonCase",{type:"string",default:""}),Collect.prototype.initialize=function(){this.entity.button.on("click",this.onPlay,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this)},Collect.prototype.update=function(t){},Collect.prototype.onPlay=function(){this.collectEvent()},Collect.prototype.onKeyDown=function(t){this.entity.enabled&&(t.key!==pc.KEY_SPACE&&t.key!==pc.KEY_ENTER||this.collectEvent(),t.event.preventDefault())},Collect.prototype.collectEvent=function(){var t=this.app.root.findByName("Game");switch(this.buttonCase+""){case"Common":t.script.game.commonChestRewardCollect();break;case"Rare":t.script.game.rareChestRewardCollect();break;case"Epic":t.script.game.epicChestRewardCollect()}this.entity.parent.enabled=!1};

//# sourceMappingURL=__game-scripts.js.map